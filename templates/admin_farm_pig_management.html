<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pig Management - Pig Farm Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    screens: {
                        'xs': '475px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '2xl': '1536px',
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        },
                        accent: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-4px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.closed {
            transform: translateX(-100%);
        }
        @media (min-width: 768px) {
            .sidebar.closed {
                transform: translateX(0);
            }
        }

        /* Custom scrollbar for sidebar */
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: rgb(156 163 175) transparent;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgb(156 163 175);
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background-color: rgb(107 114 128);
        }

        /* Responsive sidebar width */
        @media (min-width: 768px) {
            #sidebar {
                width: 16rem; /* 256px - consistent width */
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/30 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20 transition-colors duration-300">
    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full w-72 bg-white dark:bg-gray-900 shadow-2xl z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
        <div class="flex flex-col h-full">
            <!-- Sidebar Header -->
            <div class="relative px-6 py-8 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-600">
                <div class="absolute inset-0 bg-gradient-to-r from-pink-500/90 via-purple-500/90 to-blue-600/90"></div>
                <div class="relative flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-piggy-bank text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-white">Pig Management</h2>
                            <p class="text-pink-100 text-sm font-medium">Control Center</p>
                        </div>
                    </div>
                    <button id="close-sidebar" class="md:hidden p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-xl transition-all duration-300">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto scrollbar-thin">
                <!-- Pig Management (Active) -->
                <a href="/admin/farm/pig-management" class="group flex items-center px-4 py-4 bg-gradient-to-r from-pink-100 via-purple-100 to-blue-100 dark:from-pink-900/40 dark:via-purple-900/40 dark:to-blue-900/40 text-pink-700 dark:text-pink-300 rounded-2xl shadow-lg border border-pink-200/60 dark:border-pink-700/60 hover:shadow-xl transition-all duration-300 hover:scale-[1.02]">
                    <div class="w-10 h-10 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                        <i class="fas fa-piggy-bank text-white text-lg"></i>
                    </div>
                    <div class="min-w-0 flex-1">
                        <span class="font-semibold text-sm text-gray-900 dark:text-white block">Pig Management</span>
                        <p class="text-xs text-pink-600 dark:text-pink-400 font-medium">Active Page</p>
                    </div>
                    <div class="ml-2 w-3 h-3 bg-pink-500 rounded-full animate-pulse flex-shrink-0"></div>
                </a>
                
                <!-- Navigation Links -->
                <div class="space-y-1 mt-6">
                    <a href="/admin/farm/register-pigs" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-blue-100 dark:bg-blue-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-plus text-blue-600 dark:text-blue-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Register New Pig</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                    
                    <a href="/admin/farm/breeding-management" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-pink-600 dark:hover:text-pink-400 hover:bg-pink-50 dark:hover:bg-pink-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-pink-100 dark:bg-pink-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-heart text-pink-600 dark:text-pink-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Breeding Management</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                    
                    <a href="/admin/farm/health-management" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-green-100 dark:bg-green-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-heartbeat text-green-600 dark:text-green-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Health Management</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                    
                    <a href="/admin/farm/location" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-yellow-600 dark:hover:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-yellow-100 dark:bg-yellow-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-map-marker-alt text-yellow-600 dark:text-yellow-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Location</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                    
                    <a href="/admin/farm/slaughter" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-red-100 dark:bg-red-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-cut text-red-600 dark:text-red-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Slaughter</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                    
                    <a href="/admin/farm/feeding-management" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-8 h-8 bg-orange-100 dark:bg-orange-800/50 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <i class="fas fa-utensils text-orange-600 dark:text-orange-400 text-sm"></i>
                        </div>
                        <span class="text-sm font-medium flex-1">Feeding Management</span>
                        <i class="fas fa-chevron-right text-xs group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0"></i>
                    </a>
                </div>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-pink-200/60 dark:border-pink-700/60">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0">
                            <i class="fas fa-info-circle text-white text-sm"></i>
                        </div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm font-semibold text-gray-900 dark:text-white">Need Help?</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Contact Support</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden hidden"></div>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-30 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 shadow-sm">
        <div class="flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16">
            <div class="flex items-center space-x-4">
                <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                    <i class="fas fa-bars text-lg"></i>
                </button>
                
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-piggy-bank text-white text-sm sm:text-lg"></i>
                    </div>
                    <div class="hidden sm:block">
                        <h1 class="text-lg font-bold text-gray-900 dark:text-white">PigFarm Pro</h1>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Meru Farm Management</p>
                    </div>
                </div>
                
                <div class="hidden lg:flex items-center space-x-2 ml-6">
                    <span class="text-gray-400 dark:text-gray-500">/</span>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Farm Management</span>
                    <span class="text-gray-400 dark:text-gray-500">/</span>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Pig Management</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-3 sm:space-x-4">
                <div class="hidden sm:block text-right">
                    <div id="live-time" class="text-sm font-medium text-gray-900 dark:text-white">12:00:00 PM</div>
                    <div id="live-date" class="text-xs text-gray-600 dark:text-gray-400">January 1, 2024</div>
                </div>
                
                <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <svg id="sun-icon" class="w-5 h-5 text-gray-600 dark:text-gray-300 hidden" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                    </svg>
                    <svg id="moon-icon" class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                    </svg>
                </button>
                
                <div class="relative">
                    <button id="user-dropdown-btn" class="flex items-center space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-sm">👑</span>
                        </div>
                        <div class="hidden sm:block text-left">
                            <div class="text-sm font-medium text-gray-900 dark:text-white">{{ user.name }}</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">{{ user.role.title() }}</div>
                        </div>
                        <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <div id="user-dropdown" class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 hidden">
                        <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold text-sm">👑</span>
                                </div>
                                <div>
                                    <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ user.name }}</div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">{{ user.email }}</div>
                                    <div class="text-xs text-blue-600 dark:text-blue-400 font-medium">{{ user.role.title() }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="py-2">
                            <a href="/profile" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                My Profile
                            </a>
                            <button id="logout-btn" class="w-full flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out shadow-lg">
        <div class="flex flex-col h-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                    <div class="min-w-0 flex-1">
                        <h2 class="text-lg font-bold text-gray-900 dark:text-white">Pig Management</h2>
                        <p class="text-xs text-gray-600 dark:text-gray-400 font-medium">Pig Control Center</p>
                    </div>
                </div>
                <button id="close-sidebar" class="group md:hidden p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 hover:scale-110 flex-shrink-0">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <nav class="flex-1 p-4 space-y-3 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent">
                <!-- Pig Management (Active) -->
                <a href="/admin/farm/pig-management" class="group flex items-center px-4 py-4 bg-gradient-to-r from-pink-100 via-purple-100 to-blue-100 dark:from-pink-900/40 dark:via-purple-900/40 dark:to-blue-900/40 text-pink-700 dark:text-pink-300 rounded-xl shadow-lg border border-pink-200/60 dark:border-pink-700/60 hover:shadow-xl transition-all duration-300 hover:scale-[1.02]">
                    <div class="w-10 h-10 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                    <div class="min-w-0 flex-1">
                        <span class="font-semibold text-sm text-gray-900 dark:text-white block">Pig Management</span>
                        <p class="text-xs text-pink-600 dark:text-pink-400 font-medium">Active Page</p>
                    </div>
                    <!-- Active indicator -->
                    <div class="ml-2 w-3 h-3 bg-pink-500 rounded-full animate-pulse flex-shrink-0"></div>
                </a>
                
                <!-- Pig Management Sub-links -->
                <div class="ml-6 space-y-2 border-l-2 border-pink-200 dark:border-pink-700/50 pl-4">
                    <a href="/admin/farm/register-pigs" class="group flex items-center px-3 py-3 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-blue-100 dark:bg-blue-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Register New Pig</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    
                    <a href="/admin/farm/breeding-management" class="group flex items-center px-3 py-3 text-pink-600 dark:text-pink-400 hover:text-pink-800 dark:hover:text-pink-300 hover:bg-pink-50 dark:hover:bg-pink-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-pink-100 dark:bg-pink-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-pink-600 dark:text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Breeding Management</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    
                    <a href="/admin/farm/health-management" class="group flex items-center px-3 py-3 text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-green-100 dark:bg-green-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Health Management</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    
                    <a href="/admin/farm/location" class="group flex items-center px-3 py-3 text-yellow-600 dark:text-yellow-400 hover:text-yellow-800 dark:hover:text-yellow-300 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-yellow-100 dark:bg-yellow-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Location</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    
                    <a href="/admin/farm/slaughter" class="group flex items-center px-3 py-3 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-red-100 dark:bg-red-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Slaughter</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    
                    <a href="/admin/farm/feeding-management" class="group flex items-center px-3 py-3 text-orange-600 dark:text-orange-400 hover:text-orange-800 dark:hover:text-orange-300 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-md">
                        <div class="w-6 h-6 bg-orange-100 dark:bg-orange-800/50 rounded-md flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                            <svg class="w-4 h-4 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                            </svg>
                        </div>
                        <span class="text-sm font-medium flex-1">Feeding Management</span>
                        <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>
            </nav>
            
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-pink-200/60 dark:border-pink-700/60 shadow-sm hover:shadow-md transition-all duration-300">
                    <div class="flex items-center space-x-3">
                        <div class="w-7 h-7 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm font-semibold text-gray-900 dark:text-white">Need Help?</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Contact Support</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-30 md:hidden hidden"></div>

    <!-- Main Content -->
    <main class="pt-16 md:ml-72 min-h-screen">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-6 lg:py-8">
            <!-- Page Header -->
            <div class="mb-8 animate-slide-up">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 sm:p-8">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-piggy-bank text-white text-2xl"></i>
                            </div>
                    <div>
                                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2">Pig Management</h1>
                                <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 font-medium">Manage pig records, health status, and breeding information</p>
                                <div class="flex items-center space-x-2 mt-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs font-semibold text-green-600 dark:text-green-400">Live Updates</span>
                                </div>
                            </div>
                    </div>
                    <div class="flex items-center space-x-3">
                            <button onclick="loadPigs()" class="group p-3 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Refresh pigs">
                                <i class="fas fa-sync-alt text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                            </button>
                            <button id="theme-toggle" class="group p-3 text-gray-600 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Toggle theme">
                                <i class="fas fa-moon text-lg group-hover:scale-110 transition-transform duration-300"></i>
                            </button>
                            <a href="/admin/farm/register-pigs" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                                <i class="fas fa-plus mr-2"></i>
                            Register New Pig
                        </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Search Section -->
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 mb-6 sm:mb-8 animate-slide-up">
                <div class="px-3 sm:px-6 py-4 sm:py-6">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-search text-white text-lg sm:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Search Pigs</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Find pigs by tag ID</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="clearSearch()" class="group px-3 sm:px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 transition-all duration-200 hover:shadow-md">
                                <i class="fas fa-times mr-2"></i>
                                <span class="hidden sm:inline">Clear</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Input -->
                    <div class="mt-4">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-tag text-gray-400"></i>
                            </div>
                            <input 
                                type="text" 
                                id="tagSearchInput" 
                                placeholder="Enter tag ID to search..." 
                                class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-white transition-all duration-200"
                                onkeyup="searchPigs(this.value)"
                            >
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <div id="searchSpinner" class="hidden">
                                    <i class="fas fa-spinner fa-spin text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                        <div id="searchResults" class="mt-3 text-sm text-gray-600 dark:text-gray-400 hidden">
                            <span id="searchCount">0</span> pigs found
                        </div>
                    </div>
                </div>
            </div>


            <!-- Pigs Table Section -->
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 animate-slide-up">
                <!-- Section Header -->
                <div class="px-3 sm:px-6 py-4 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-list text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Registered Pigs</h2>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Manage and monitor all pig records</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="loadPigs()" class="group px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 hover:shadow-md">
                                <i class="fas fa-sync-alt mr-2 group-hover:rotate-180 transition-transform duration-500"></i>
                                Refresh
                            </button>
                        </div>
                        </div>
                    </div>

                    <!-- Pigs Table -->
                    <div class="overflow-x-auto">
                        <!-- Desktop Table -->
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 hidden lg:table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tag ID</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Farm</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Source</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Breed</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Gender</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Purpose</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Breeding Status</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Age (days)</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pigs-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="11" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                        Loading pigs...
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Tablet Table (Medium screens) -->
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 hidden md:table lg:hidden">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tag ID</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Farm</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Breed</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Age</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pigs-table-body-md" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="7" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                        Loading pigs...
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Mobile Cards -->
                        <div id="pigs-mobile-cards" class="space-y-4 md:hidden">
                            <!-- Mobile cards will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Litters Section -->
            <div class="mt-8 bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 animate-slide-up">
                <!-- Section Header -->
                <div class="px-6 py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-yellow-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-baby text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Registered Litters</h2>
                                <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Monitor litters and their development stages</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="loadLitters()" class="group px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-orange-50 dark:hover:bg-orange-900/20 hover:text-orange-600 dark:hover:text-orange-400 transition-all duration-200 hover:shadow-md">
                                <i class="fas fa-sync-alt mr-2 group-hover:rotate-180 transition-transform duration-500"></i>
                                Refresh
                            </button>
                        </div>
                        </div>
                    </div>

                    <!-- Litters Table -->
                    <div class="overflow-x-auto">
                        <!-- Desktop Table -->
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 hidden sm:table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Litter ID</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Sow</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Farrowing Date</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Weaning Date</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Age (Days)</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Alive Piglets</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Weaning Status</th>
                                    <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="litters-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="8" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                        Loading litters...
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Mobile Cards -->
                        <div id="litters-mobile-cards" class="space-y-4 sm:hidden">
                            <!-- Mobile cards will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Pig Modal -->
    <div id="editPigModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-start sm:items-center justify-center min-h-screen p-1 sm:p-4 overflow-y-auto">
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-3xl shadow-2xl w-full max-w-4xl mx-1 sm:mx-4 my-2 sm:my-4 max-h-[98vh] sm:max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-edit text-white text-sm sm:text-lg"></i>
                            </div>
                    <div>
                                <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Edit Pig Details</h3>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">Update pig information</p>
                    </div>
                        </div>
                        <button onclick="closeEditPigModal()" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-200">
                            <i class="fas fa-times text-lg"></i>
                    </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 lg:py-8">
                    <form id="editPigForm" class="space-y-4 sm:space-y-6">
                        <input type="hidden" id="editPigId" name="pig_id">
                        
                        <!-- Farm Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-building mr-2 text-blue-500"></i>
                                Farm <span class="text-red-500">*</span>
                            </label>
                            <select id="editFarmSelect" name="farm_id" required class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200">
                                <option value="">Select a farm</option>
                            </select>
                        </div>

                        <!-- Pig Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-tag mr-2 text-purple-500"></i>
                                Type of Pig <span class="text-red-500">*</span>
                            </label>
                            <select id="editPigTypeSelect" name="pig_type" required class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200">
                                <option value="">Select pig type</option>
                                <option value="grown_pig">Grown Pig</option>
                                <option value="piglet">Piglet</option>
                                <option value="litter">Litter</option>
                                <option value="batch">Batch</option>
                            </select>
                        </div>

                        <!-- Pig Source -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-map-marker-alt mr-2 text-green-500"></i>
                                Pig Source <span class="text-red-500">*</span>
                            </label>
                            <select id="editPigSourceSelect" name="pig_source" required class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200">
                                <option value="">Select pig source</option>
                                <option value="born">Born on Farm</option>
                                <option value="purchased">Purchased</option>
                            </select>
                        </div>

                        <!-- Breed (for grown pigs) -->
                        <div id="editBreedField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-dna mr-2 text-indigo-500"></i>
                                Breed <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="editBreedInput" name="breed" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200" placeholder="e.g., Large White, Duroc">
                        </div>

                        <!-- Gender (for grown pigs) -->
                        <div id="editGenderField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-venus-mars mr-2 text-pink-500"></i>
                                Gender <span class="text-red-500">*</span>
                            </label>
                            <select id="editGenderSelect" name="gender" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200">
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>

                        <!-- Purpose (for grown pigs) -->
                        <div id="editPurposeField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-target mr-2 text-orange-500"></i>
                                Purpose <span class="text-red-500">*</span>
                            </label>
                            <select id="editPurposeSelect" name="purpose" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-xs sm:text-base transition-all duration-200">
                                <option value="">Select purpose</option>
                                <option value="breeding">Breeding</option>
                                <option value="meat">Meat</option>
                            </select>
                        </div>

                        <!-- Breeding Status (Read-only) -->
                        <div id="editBreedingStatusField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-3">
                                <i class="fas fa-heart mr-2 text-red-500"></i>
                                Breeding Status
                            </label>
                            <input type="text" id="editBreedingStatusDisplay" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg sm:rounded-2xl bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 cursor-not-allowed text-xs sm:text-base" readonly>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ℹ️ Breeding status is automatically set based on pig's age and purpose. For breeding pigs: "available" (≥200 days) or "young" (<200 days). Meat pigs have no breeding status.</p>
                        </div>

                        <!-- Birth Date -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Birth Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="editBirthDateInput" name="birth_date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required field. Cannot be in the future.</p>
                        </div>

                        <!-- Purchase Date -->
                        <div id="editPurchaseDateField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Purchase Date
                            </label>
                            <input type="date" id="editPurchaseDateInput" name="purchase_date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>

                        <!-- Tag ID (Editable) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Tag ID <span class="text-red-500">*</span>
                            </label>
                            <div class="flex space-x-2">
                                <input type="text" id="editTagIdInput" name="tag_id" required class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" placeholder="e.g., P001, S001" maxlength="10" oninput="onTagIdInput()">
                                <button type="button" id="validateTagIdBtn" onclick="validateTagId()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <span id="validateBtnText">Validate</span>
                                    <span id="validateBtnSpinner" class="hidden">
                                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                            <div id="tagIdValidationMessage" class="mt-2 text-sm hidden"></div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <strong>Note:</strong> Format: Letter + Numbers (e.g., P001, S001). 
                                <br>After editing, the tag ID will automatically get an "E" prefix (e.g., EP001) to show it has been modified.
                            </p>
                        </div>

                        <!-- Status (Editable with reason) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Status
                            </label>
                            <select id="editStatusSelect" name="status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" onchange="toggleStatusReasonField()">
                                <option value="active">Active</option>
                                <option value="sold">Sold</option>
                                <option value="deceased">Deceased</option>
                                <option value="slaughtered">Slaughtered</option>
                                <option value="transferred">Transferred</option>
                            </select>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">⚠️ Status changes require a reason and are logged for audit purposes</p>
                        </div>

                        <!-- Status Change Reason (shown only when status changes) -->
                        <div id="statusReasonField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Reason for Status Change <span class="text-red-500">*</span>
                            </label>
                            <textarea id="statusReasonInput" name="status_reason" rows="3" placeholder="Please provide a detailed reason for changing the pig status..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none"></textarea>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">This reason will be logged in the audit trail for compliance and tracking purposes</p>
                        </div>

                        <!-- Important Notes -->
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200">Important Notes</h4>
                                    <ul class="mt-2 text-xs text-blue-700 dark:text-blue-300 space-y-1">
                                        <li>• Birth date is required and cannot be in the future</li>
                                        <li>• Tag ID will be prefixed with "E" after editing (e.g., P001 becomes EP001)</li>
                                        <li>• Pig status can be changed but requires a reason</li>
                                        <li>• Breeding status cannot be changed through this form</li>
                                        <li>• All changes are logged and tracked in the system</li>
                                        <li>• Ages are automatically calculated and updated</li>
                                        <li>• Edited pigs show ✏️ icon in the table</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Modal Footer -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-xl sm:rounded-b-3xl">
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 lg:space-x-6">
                        <button onclick="closeEditPigModal()" class="flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200 hover:shadow-md text-sm sm:text-base font-semibold">
                            <i class="fas fa-times mr-2"></i>
                        Cancel
                    </button>
                        <button onclick="submitPigEdit()" class="flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl transition-all duration-200 hover:shadow-lg hover:scale-105 text-sm sm:text-base font-semibold">
                            <i class="fas fa-save mr-2"></i>
                        Update Pig
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Litter Modal -->
    <div id="editLitterModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-start sm:items-center justify-center min-h-screen p-1 sm:p-4 overflow-y-auto">
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-3xl shadow-2xl w-full max-w-4xl mx-1 sm:mx-4 my-2 sm:my-4 max-h-[98vh] sm:max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-orange-500 to-yellow-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-baby text-white text-sm sm:text-lg"></i>
                    </div>
                            <div>
                                <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Edit Litter Details</h3>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">Update litter information</p>
                            </div>
                        </div>
                        <button onclick="closeEditLitterModal()" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-200">
                            <i class="fas fa-times text-lg"></i>
                    </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="p-4 sm:p-6">
                    <form id="editLitterForm" class="space-y-4 sm:space-y-6">
                        <input type="hidden" id="editLitterId" name="litter_id">
                        
                        <!-- Litter ID (Editable) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Litter ID <span class="text-red-500">*</span>
                            </label>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="text" id="editLitterIdInput" name="litter_id" required class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" placeholder="e.g., L001" maxlength="10" oninput="onLitterIdInput()">
                                <button type="button" id="validateLitterIdBtn" onclick="validateLitterId()" class="px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                                    <span id="validateLitterBtnText">Validate</span>
                                    <span id="validateLitterBtnSpinner" class="hidden">
                                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                            <div id="litterIdValidationMessage" class="mt-2 text-sm hidden"></div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <strong>Note:</strong> Format: Start with letter, then letters/numbers (e.g., L001, EL001). 
                                <br class="hidden sm:block">After editing, the litter ID will automatically get an "E" prefix (e.g., EL001) to show it has been modified.
                            </p>
                        </div>

                        <!-- Sow Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Sow <span class="text-red-500">*</span>
                            </label>
                            <select id="editSowSelect" name="sow_id" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="">Select a sow</option>
                            </select>
                        </div>

                        <!-- Farrowing Date -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Farrowing Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="editFarrowingDateInput" name="farrowing_date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required field. Cannot be in the future.</p>
                        </div>

                        <!-- Status -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Status
                            </label>
                            <select id="editLitterStatusSelect" name="status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" onchange="toggleWeaningFields()">
                                <option value="unweaned">Unweaned</option>
                                <option value="weaned">Weaned</option>
                            </select>
                        </div>

                        <!-- Weaning Date (conditional) -->
                        <div id="weaningDateField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Weaning Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="editWeaningDateInput" name="weaning_date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required when status is "Weaned".</p>
                        </div>

                        <!-- Alive Piglets -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Alive Piglets <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="editAlivePigletsInput" name="alive_piglets" required min="0" max="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" placeholder="Number of alive piglets">
                        </div>

                        <!-- Weaning Weight (conditional) -->
                        <div id="weaningWeightField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Weaning Weight (kg) <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="editWeaningWeightInput" name="weaning_weight" min="0" step="0.1" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" placeholder="Average weight at weaning">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required when status is "Weaned".</p>
                        </div>

                        <!-- Important Notes -->
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200">Important Notes</h4>
                                    <ul class="mt-2 text-xs text-blue-700 dark:text-blue-300 space-y-1">
                                        <li>• Farrowing date is required and cannot be in the future</li>
                                        <li>• Litter ID will be prefixed with "E" after editing (e.g., L001 becomes EL001)</li>
                                        <li>• Weaning date is optional and can be set later</li>
                                        <li>• All changes are logged and tracked in the system</li>
                                        <li>• Ages are automatically calculated and updated</li>
                                        <li>• Edited litters show ✏️ icon in the table</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Modal Footer -->
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-end space-y-2 sm:space-y-0 sm:space-x-3 p-4 sm:p-6 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="closeEditLitterModal()" class="w-full sm:w-auto px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-sm sm:text-base">
                        Cancel
                    </button>
                    <button onclick="submitLitterEdit()" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                        Update Litter
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Changes Summary Modal -->
    <div id="changesSummaryModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Changes Summary</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">The following changes were made to the pig</p>
                    </div>
                    <button onclick="closeChangesSummaryModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <div id="changesSummaryContent" class="space-y-3">
                        <!-- Changes will be populated here -->
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end p-6 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="closeChangesSummaryModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Litter Registration Modal -->
    <div id="litterRegistrationModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Litter Registration</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Sow <span id="litterSowTagId" class="font-semibold text-blue-600 dark:text-blue-400"></span> has completed breeding cycle
                        </p>
                    </div>
                    <button onclick="closeLitterRegistrationModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
                    <!-- Sow Information Section -->
                    <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Sow Information</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tag ID:</span>
                                <span id="litterSowTagIdInfo" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Breed:</span>
                                <span id="litterSowBreed" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Age:</span>
                                <span id="litterSowAge" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Farm:</span>
                                <span id="litterSowFarm" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Breeding Record Information -->
                    <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3">Breeding Cycle Details</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-blue-600 dark:text-blue-400">Mating Date:</span>
                                <span id="litterMatingDate" class="ml-2 font-medium text-blue-800 dark:text-blue-200"></span>
                            </div>
                            <div>
                                <span class="text-blue-600 dark:text-blue-400">Expected Farrowing:</span>
                                <span id="litterExpectedFarrowing" class="ml-2 font-medium text-blue-800 dark:text-blue-200"></span>
                            </div>
                            <div>
                                <span class="text-blue-600 dark:text-blue-400">Boar Used:</span>
                                <span id="litterBoarUsed" class="ml-2 font-medium text-blue-800 dark:text-blue-200"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Litter Registration Form -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Litter Details</h4>
                        <form id="litterRegistrationForm" class="space-y-4">
                            <input type="hidden" id="litterSowId" name="sow_id">
                            <input type="hidden" id="litterBreedingRecordId" name="breeding_record_id">
                            
                            <!-- Litter ID -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Litter ID <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="litterIdInput" name="litter_id" value="L001" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" readonly>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Litter ID is automatically generated</p>
                            </div>

                            <!-- Farrowing Date -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Farrowing Date <span class="text-red-500">*</span>
                                </label>
                                <input type="date" id="litterFarrowingDate" name="farrowing_date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" required>
                            </div>

                            <!-- Total Piglets -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Total Piglets Born <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="litterTotalPiglets" name="total_piglets" min="1" max="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" required>
                            </div>

                            <!-- Alive Piglets -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Alive Piglets <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="litterAlivePiglets" name="alive_piglets" min="0" max="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" required>
                            </div>

                            <!-- Still Births -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Still Births
                                </label>
                                <input type="number" id="litterStillBirths" name="still_births" min="0" max="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" value="0">
                            </div>

                            <!-- Average Weight -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Average Piglet Weight (kg)
                                </label>
                                <input type="number" id="litterAvgWeight" name="avg_weight" min="0.1" max="5.0" step="0.1" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
                            </div>

                            <!-- Notes -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Notes
                                </label>
                                <textarea id="litterNotes" name="notes" rows="3" placeholder="Additional notes about the litter..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none"></textarea>
                            </div>
                        </form>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-center space-x-4">
                        <button onclick="postponeLitterRegistration()" class="px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Postpone
                        </button>
                        <button onclick="registerLitter()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Register Litter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Postpone Reason Modal -->
    <div id="postponeReasonModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Postpone Litter Registration</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Please provide a reason for postponing the litter registration</p>
                    </div>
                    <button onclick="closePostponeReasonModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Reason for Postponement <span class="text-red-500">*</span>
                        </label>
                        <textarea id="postponeReasonInput" rows="4" placeholder="Please provide a detailed reason for postponing the litter registration..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none" required></textarea>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="closePostponeReasonModal()" class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button onclick="confirmPostpone()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                        Confirm Postponement
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Trail Modal -->
    <div id="auditTrailModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Pig Audit Trail</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Complete history of changes for pig: <span id="auditPigTagId" class="font-semibold text-blue-600 dark:text-blue-400"></span>
                        </p>
                    </div>
                    <button onclick="closeAuditTrailModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
                    <!-- Pig Info Section -->
                    <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Pig Information</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tag ID:</span>
                                <span id="auditPigTagIdInfo" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Farm:</span>
                                <span id="auditPigFarm" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Type:</span>
                                <span id="auditPigType" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Status:</span>
                                <span id="auditPigStatus" class="ml-2 font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Trail Section -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Change History</h4>
                        <div id="auditTrailContent" class="space-y-3">
                            <!-- Audit entries will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end p-6 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="closeAuditTrailModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Pig Confirmation Modal -->
    <div id="deletePigModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="px-6 py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Delete Pig</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">This action cannot be undone</p>
                        </div>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="px-6 py-6">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 dark:bg-red-900/20 mb-4">
                            <i class="fas fa-trash text-red-600 dark:text-red-400 text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Are you sure?</h4>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            You are about to delete pig with tag ID: <span id="deletePigTagId" class="font-semibold text-gray-900 dark:text-white"></span>
                        </p>
                        <p class="text-sm text-red-600 dark:text-red-400 font-medium">
                            ⚠️ This will permanently remove the pig and all associated data from the system.
                        </p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-2xl">
                    <div class="flex space-x-3">
                        <button onclick="closeDeletePigModal()" class="flex-1 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-500 transition-all duration-200 font-semibold">
                            <i class="fas fa-times mr-2"></i>
                            Cancel
                        </button>
                        <button onclick="confirmDeletePig()" class="flex-1 px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white rounded-xl transition-all duration-200 hover:shadow-lg hover:scale-105 font-semibold">
                            <i class="fas fa-trash mr-2"></i>
                            Delete Pig
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">🐷</span>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">PigFarm Pro</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Meru Farm Management System</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <p class="text-xs text-gray-600 dark:text-gray-400">© 2024 Meru Farm. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Dark Mode Toggle
        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.documentElement.classList.contains('dark');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            
            if (sunIcon && moonIcon) {
                sunIcon.classList.toggle('hidden', isDark);
                moonIcon.classList.toggle('hidden', !isDark);
            }
        }

        // Initialize theme from localStorage
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.classList.toggle('dark', currentTheme === 'dark');
        updateThemeIcon();

        // Mobile Sidebar Functionality
        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const closeSidebarBtn = document.getElementById('close-sidebar');
            const mobileOverlay = document.getElementById('mobile-overlay');

            if (mobileMenuBtn && sidebar) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.remove('-translate-x-full');
                    if (mobileOverlay) {
                        mobileOverlay.classList.remove('hidden');
                    }
                    document.body.classList.add('overflow-hidden');
                });
            }

            if (closeSidebarBtn && sidebar) {
                closeSidebarBtn.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    if (mobileOverlay) {
                        mobileOverlay.classList.add('hidden');
                    }
                    document.body.classList.remove('overflow-hidden');
                });
            }

            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    mobileOverlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                });
            }
        }

        // User Dropdown
        const userDropdownBtn = document.getElementById('user-dropdown-btn');
        const userDropdown = document.getElementById('user-dropdown');
        
        userDropdownBtn.addEventListener('click', () => {
            userDropdown.classList.toggle('hidden');
        });
        
        document.addEventListener('click', (e) => {
            if (!userDropdownBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.classList.add('hidden');
            }
        });

        // Mobile Sidebar Functionality
        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const closeSidebarBtn = document.getElementById('close-sidebar');
            const mobileOverlay = document.getElementById('mobile-overlay');

            // Open sidebar
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.remove('-translate-x-full');
                    mobileOverlay.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');
                });
            }

            // Close sidebar
            function closeSidebar() {
                sidebar.classList.add('-translate-x-full');
                mobileOverlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }

            if (closeSidebarBtn) {
                closeSidebarBtn.addEventListener('click', closeSidebar);
            }

            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', closeSidebar);
            }

            // Close sidebar on window resize if it's desktop
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768) {
                    closeSidebar();
                }
            });

            // Close sidebar when clicking on sidebar links
            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) {
                        closeSidebar();
                    }
                });
            });
        }

        // Call setupMobileMenu on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            setupMobileMenu();
        });

        // Live Time
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('live-time');
            const dateElement = document.getElementById('live-date');
            
            timeElement.textContent = now.toLocaleTimeString('en-US', {
                hour12: true,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            dateElement.textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        updateTime();
        setInterval(updateTime, 1000);

        // Logout
        document.getElementById('logout-btn').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = data.redirect;
                }
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/';
            }
        });

        // Pig Management Functions
        let currentPigData = null;
        let currentLittersData = [];

        // Load pigs on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPigs();
            loadLitters();
            loadFarms();
            recalculateAllPigAges();
            checkCompletedBreedingCycles();
        });

        // Recalculate ages for all pigs
        function recalculateAllPigAges() {
            fetch('/api/pig/recalculate-ages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    console.log('Pig ages recalculated successfully');
                    // Refresh the pigs list to show updated ages
                    setTimeout(function() { loadPigs(); }, 1000);
                }
            })
            .catch(error => {
                console.error('Error recalculating pig ages:', error);
            });
        }

        // Load farms for dropdown
        function loadFarms() {
            fetch('/api/farm/list')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const farmSelect = document.getElementById('editFarmSelect');
                    if (farmSelect) {
                        farmSelect.innerHTML = '<option value="">Select a farm</option>';
                        
                        data.farms.forEach(function(farm) {
                            const option = document.createElement('option');
                            option.value = farm.id;
                            option.textContent = farm.farm_name;
                            farmSelect.appendChild(option);
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error loading farms:', error);
                showToast('Error loading farms', 'error');
            });
        }

        // Global variables for search functionality
        let allPigs = [];
        let filteredPigs = [];

        // Load pigs for table
        function loadPigs() {
            fetch('/api/pig/list')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    allPigs = data.pigs; // Store all pigs globally
                    filteredPigs = data.pigs; // Initially show all pigs
                    displayPigs(data.pigs);
                } else {
                    allPigs = [];
                    filteredPigs = [];
                    displayPigs([]);
                }
            })
            .catch(error => {
                console.error('Error loading pigs:', error);
                allPigs = [];
                filteredPigs = [];
                displayPigs([]);
            });
        }

        // Search pigs by tag ID
        function searchPigs(searchTerm) {
            const spinner = document.getElementById('searchSpinner');
            const searchResults = document.getElementById('searchResults');
            const searchCount = document.getElementById('searchCount');
            
            // Show spinner
            spinner.classList.remove('hidden');
            
            // Simulate search delay for better UX
            setTimeout(() => {
                if (searchTerm.trim() === '') {
                    // Show all pigs if search is empty
                    filteredPigs = allPigs;
                    searchResults.classList.add('hidden');
                } else {
                    // Filter pigs by tag ID (case insensitive)
                    filteredPigs = allPigs.filter(pig => 
                        pig.tag_id.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    
                    // Show search results
                    searchResults.classList.remove('hidden');
                    searchCount.textContent = filteredPigs.length;
                }
                
                // Update display
                displayPigs(filteredPigs);
                
                // Hide spinner
                spinner.classList.add('hidden');
            }, 300);
        }

        // Clear search
        function clearSearch() {
            const searchInput = document.getElementById('tagSearchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.value = '';
            searchResults.classList.add('hidden');
            filteredPigs = allPigs;
            displayPigs(allPigs);
        }

        // Global variable to store pig ID for deletion
        let pigToDelete = null;

        // Delete pig function
        function deletePig(pigId, tagId) {
            pigToDelete = pigId;
            document.getElementById('deletePigTagId').textContent = tagId;
            
            // Show modal with animation
            const modal = document.getElementById('deletePigModal');
            const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
            modal.classList.remove('hidden');
            
            // Trigger animation after a small delay to ensure the modal is visible
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        // Close delete pig modal
        function closeDeletePigModal() {
            const modal = document.getElementById('deletePigModal');
            const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
            
            // Animate out
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            // Hide modal after animation
            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset styles for next time
                modalContent.style.transform = 'scale(0.95)';
                modalContent.style.opacity = '0';
            }, 300);
            
            pigToDelete = null;
        }

        // Confirm delete pig
        function confirmDeletePig() {
            if (!pigToDelete) {
                showToast('No pig selected for deletion', 'error');
                return;
            }

            // Show loading state
            const deleteButton = document.querySelector('button[onclick="confirmDeletePig()"]');
            const originalText = deleteButton.innerHTML;
            deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...';
            deleteButton.disabled = true;

            // Make API call to delete pig
            fetch(`/api/pig/delete/${pigToDelete}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message, 'success');
                    closeDeletePigModal();
                    
                    // Remove pig from local arrays
                    allPigs = allPigs.filter(pig => pig.id !== pigToDelete);
                    filteredPigs = filteredPigs.filter(pig => pig.id !== pigToDelete);
                    
                    // Refresh display
                    displayPigs(filteredPigs);
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error deleting pig:', error);
                showToast('Error deleting pig. Please try again.', 'error');
            })
            .finally(() => {
                // Reset button state
                deleteButton.innerHTML = originalText;
                deleteButton.disabled = false;
            });
        }

        // Display pigs in table
        function displayPigs(pigs) {
            const tbody = document.getElementById('pigs-table-body');
            const tbodyMd = document.getElementById('pigs-table-body-md');
            const mobileCards = document.getElementById('pigs-mobile-cards');
            
            if (pigs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                            No pigs registered yet
                        </td>
                    </tr>
                `;
                tbodyMd.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                            No pigs registered yet
                        </td>
                    </tr>
                `;
                mobileCards.innerHTML = `
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-piggy-bank text-4xl mb-4"></i>
                        <p>No pigs registered yet</p>
                    </div>
                `;
                return;
            }

            // Desktop table (full details)
            tbody.innerHTML = pigs.map(pig => {
                // Check if pig has been edited
                const isEdited = pig.is_edited || pig.tag_id.startsWith('E');
                const displayTagId = pig.tag_id; // Show the actual tag ID (with E if edited)
                const tagIdClass = isEdited 
                    ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200' 
                    : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                
                return `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <button onclick="viewAuditTrail(${pig.id})" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tagIdClass} hover:opacity-80 cursor-pointer transition-opacity" title="Click to view audit trail">
                                ${displayTagId}
                            </button>
                            ${isEdited ? '<span class="text-xs text-orange-600 dark:text-orange-400" title="This pig has been edited">✏️</span>' : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.farm_name}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                            ${pig.pig_type.replace('_', ' ')}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">
                            ${pig.pig_source}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.breed || '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.gender || '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.purpose ? pig.purpose.charAt(0).toUpperCase() + pig.purpose.slice(1) : '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.breeding_status ? pig.breeding_status.charAt(0).toUpperCase() + pig.breeding_status.slice(1) : '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.age_days ? pig.age_days + ' days' : 'Calculating...'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                            ${pig.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-center space-x-2">
                            <button onclick="editPig(${pig.id})" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300" title="Edit pig">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deletePig(${pig.id}, '${pig.tag_id}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete pig">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');

            // Tablet table (medium screens - condensed view)
            tbodyMd.innerHTML = pigs.map(pig => {
                const isEdited = pig.is_edited || pig.tag_id.startsWith('E');
                const displayTagId = pig.tag_id;
                const tagIdClass = isEdited 
                    ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200' 
                    : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                
                return `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-3 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <button onclick="viewAuditTrail(${pig.id})" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tagIdClass} hover:opacity-80 cursor-pointer transition-opacity" title="Click to view audit trail">
                                ${displayTagId}
                            </button>
                            ${isEdited ? '<span class="text-xs text-orange-600 dark:text-orange-400" title="This pig has been edited">✏️</span>' : ''}
                        </div>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.farm_name}
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                            ${pig.pig_type.replace('_', ' ')}
                        </span>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.breed || '-'}
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${pig.age_days ? pig.age_days + ' days' : 'Calculating...'}
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                            ${pig.status}
                        </span>
                    </td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-center space-x-2">
                            <button onclick="editPig(${pig.id})" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300" title="Edit pig">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deletePig(${pig.id}, '${pig.tag_id}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete pig">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');

            // Mobile cards
            mobileCards.innerHTML = pigs.map(pig => {
                const isEdited = pig.is_edited || pig.tag_id.startsWith('E');
                const displayTagId = pig.tag_id;
                const tagIdClass = isEdited 
                    ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200' 
                    : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                
                return `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl transition-all duration-200">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <button onclick="viewAuditTrail(${pig.id})" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${tagIdClass} hover:opacity-80 cursor-pointer transition-opacity" title="Click to view audit trail">
                                ${displayTagId}
                            </button>
                            ${isEdited ? '<span class="text-xs text-orange-600 dark:text-orange-400" title="This pig has been edited">✏️</span>' : ''}
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                ${pig.pig_type.replace('_', ' ')}
                            </span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                ${pig.status}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Details Grid -->
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Farm</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.farm_name}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Age</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.age_days ? pig.age_days + ' days' : 'Calculating...'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Breed</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.breed || '-'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Gender</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.gender || '-'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Purpose</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.purpose ? pig.purpose.charAt(0).toUpperCase() + pig.purpose.slice(1) : '-'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Breeding Status</p>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${pig.breeding_status ? pig.breeding_status.charAt(0).toUpperCase() + pig.breeding_status.slice(1) : '-'}</p>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400">
                            <span>Source: ${pig.pig_source}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editPig(${pig.id})" class="inline-flex items-center px-3 py-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-lg transition-colors">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Edit
                            </button>
                            <button onclick="deletePig(${pig.id}, '${pig.tag_id}')" class="inline-flex items-center px-3 py-1 bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-medium rounded-lg transition-colors">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        // Load litters for table
        function loadLitters() {
            fetch('/api/litter/all')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentLittersData = data.litters; // Store the data globally
                    displayLitters(data.litters);
                } else {
                    currentLittersData = [];
                    document.getElementById('litters-table-body').innerHTML = `
                        <tr>
                            <td colspan="8" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                No litters registered yet
                            </td>
                        </tr>
                    `;
                }
            })
            .catch(error => {
                console.error('Error loading litters:', error);
                currentLittersData = [];
                document.getElementById('litters-table-body').innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 text-center text-red-500">
                            Error loading litters
                        </td>
                    </tr>
                `;
            });
        }

        // Display litters in table
        function displayLitters(litters) {
            const tbody = document.getElementById('litters-table-body');
            const mobileCards = document.getElementById('litters-mobile-cards');
            
            if (litters.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                            No litters registered yet
                        </td>
                    </tr>
                `;
                mobileCards.innerHTML = `
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        No litters registered yet
                    </div>
                `;
                return;
            }

            // Desktop table
            tbody.innerHTML = litters.map(litter => {
                const farrowingDate = new Date(litter.farrowing_date);
                const weaningDate = litter.weaning_date ? new Date(litter.weaning_date) : null;
                const today = new Date();
                const ageInDays = Math.floor((today - farrowingDate) / (1000 * 60 * 60 * 24));
                
                // Determine weaning status
                let weaningStatus = '';
                let weaningStatusColor = '';
                
                if (litter.weaning_date || litter.status === 'weaned') {
                    weaningStatus = 'Weaned';
                    weaningStatusColor = 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                } else if (ageInDays >= 21) {
                    weaningStatus = 'Ready for Weaning';
                    weaningStatusColor = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                } else if (ageInDays >= 14) {
                    weaningStatus = 'Creep Feeding';
                    weaningStatusColor = 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                } else {
                    weaningStatus = 'Unweaned';
                    weaningStatusColor = 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';
                }
                
                return `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">
                                ${litter.litter_id}
                            </span>
                        </div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${litter.sow_tag_id || 'N/A'}
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${farrowingDate.toLocaleDateString()}
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        ${weaningDate ? weaningDate.toLocaleDateString() : '-'}
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        <span class="font-bold text-lg">${ageInDays}</span> 
                        <span class="text-xs text-gray-500 dark:text-gray-400">days</span>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        <span class="font-bold text-lg">${litter.alive_piglets}</span>
                        ${litter.weaning_weight ? `<br><span class="text-xs text-gray-500 dark:text-gray-400">Weaned: ${litter.weaning_weight} kg</span>` : ''}
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${weaningStatusColor} shadow-sm">
                            ${weaningStatus}
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                        <div class="flex items-center space-x-2">
                            <button onclick="editLitter(${litter.id})" class="inline-flex items-center px-3 py-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-lg transition-colors">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Edit
                            </button>
                            ${!litter.weaning_date && litter.status !== 'weaned' && ageInDays >= 21 ? 
                                `<button onclick="weanLitter(${litter.id})" class="inline-flex items-center px-3 py-1 bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-lg transition-colors">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Wean
                                </button>` : 
                                (litter.weaning_date || litter.status === 'weaned') ? 
                                    '<span class="text-xs text-green-600 dark:text-green-400 font-medium">Weaned</span>' :
                                    '<span class="text-xs text-gray-500 dark:text-gray-400">Too Young</span>'
                            }
                        </div>
                    </td>
                </tr>
            `;
            }).join('');

            // Mobile cards
            mobileCards.innerHTML = litters.map(litter => {
                const farrowingDate = new Date(litter.farrowing_date);
                const weaningDate = litter.weaning_date ? new Date(litter.weaning_date) : null;
                const today = new Date();
                const ageInDays = Math.floor((today - farrowingDate) / (1000 * 60 * 60 * 24));
                
                // Determine weaning status
                let weaningStatus = '';
                let weaningStatusColor = '';
                
                if (litter.weaning_date || litter.status === 'weaned') {
                    weaningStatus = 'Weaned';
                    weaningStatusColor = 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                } else if (ageInDays >= 21) {
                    weaningStatus = 'Ready for Weaning';
                    weaningStatusColor = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                } else if (ageInDays >= 14) {
                    weaningStatus = 'Creep Feeding';
                    weaningStatusColor = 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                } else {
                    weaningStatus = 'Unweaned';
                    weaningStatusColor = 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';
                }
                
                return `
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">
                            ${litter.litter_id}
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${weaningStatusColor} shadow-sm">
                            ${weaningStatus}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Sow:</span>
                            <span class="text-gray-900 dark:text-white">${litter.sow_tag_id || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Farrowing Date:</span>
                            <span class="text-gray-900 dark:text-white">${farrowingDate.toLocaleDateString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Weaning Date:</span>
                            <span class="text-gray-900 dark:text-white">${weaningDate ? weaningDate.toLocaleDateString() : '-'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Age:</span>
                            <span class="text-gray-900 dark:text-white font-bold">${ageInDays} days</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Alive Piglets:</span>
                            <span class="text-gray-900 dark:text-white font-bold">${litter.alive_piglets}</span>
                        </div>
                        ${litter.weaning_weight ? `
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Weaning Weight:</span>
                            <span class="text-gray-900 dark:text-white">${litter.weaning_weight} kg</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="flex items-center space-x-2 mt-4">
                        <button onclick="editLitter(${litter.id})" class="flex-1 inline-flex items-center justify-center px-3 py-2 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-lg transition-colors">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Edit
                        </button>
                        ${!litter.weaning_date && litter.status !== 'weaned' && ageInDays >= 21 ? 
                            `<button onclick="weanLitter(${litter.id})" class="flex-1 inline-flex items-center justify-center px-3 py-2 bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-lg transition-colors">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Wean
                            </button>` : 
                            (litter.weaning_date || litter.status === 'weaned') ? 
                                '<span class="flex-1 text-center text-xs text-green-600 dark:text-green-400 font-medium">Weaned</span>' :
                                '<span class="flex-1 text-center text-xs text-gray-500 dark:text-gray-400">Too Young</span>'
                        }
                    </div>
                </div>
            `;
            }).join('');
        }

        // Wean litter function
        function weanLitter(litterId) {
            if (confirm('Are you sure you want to mark this litter as weaned?')) {
                fetch(`/api/litter/${litterId}/wean`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Litter marked as weaned successfully!', 'success');
                        loadLitters(); // Refresh the litters list
                    } else {
                        showToast(data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error weaning litter:', error);
                    showToast('Error weaning litter. Please try again.', 'error');
                });
            }
        }

        // Toggle weaning fields based on status
        function toggleWeaningFields() {
            const statusSelect = document.getElementById('editLitterStatusSelect');
            const weaningDateField = document.getElementById('weaningDateField');
            const weaningWeightField = document.getElementById('weaningWeightField');
            const weaningDateInput = document.getElementById('editWeaningDateInput');
            const weaningWeightInput = document.getElementById('editWeaningWeightInput');
            
            if (statusSelect.value === 'weaned') {
                weaningDateField.classList.remove('hidden');
                weaningWeightField.classList.remove('hidden');
                weaningDateInput.required = true;
                weaningWeightInput.required = true;
            } else {
                weaningDateField.classList.add('hidden');
                weaningWeightField.classList.add('hidden');
                weaningDateInput.required = false;
                weaningWeightInput.required = false;
                weaningDateInput.value = '';
                weaningWeightInput.value = '';
            }
        }

        // Edit litter function
        function editLitter(litterId) {
            // Find the litter data
            const litter = currentLittersData.find(l => l.id == litterId || l.id === parseInt(litterId));
            if (!litter) {
                showToast('Litter not found', 'error');
                return;
            }

            // Show modal with animation
            const modal = document.getElementById('editLitterModal');
            const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
            modal.classList.remove('hidden');
            
            // Trigger animation after a small delay to ensure the modal is visible
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);

            // Then populate the form with current litter data
            document.getElementById('editLitterId').value = litter.id;
            document.getElementById('editLitterIdInput').value = litter.litter_id || '';
            document.getElementById('editFarrowingDateInput').value = litter.farrowing_date || '';
            document.getElementById('editAlivePigletsInput').value = litter.alive_piglets || '';
            document.getElementById('editLitterStatusSelect').value = litter.status || 'unweaned';
            
            // Set weaning date and weight if available
            if (litter.weaning_date) {
                document.getElementById('editWeaningDateInput').value = litter.weaning_date;
            }
            if (litter.weaning_weight) {
                document.getElementById('editWeaningWeightInput').value = litter.weaning_weight;
            }

            // Toggle weaning fields based on current status
            toggleWeaningFields();

            // Load sows for the dropdown and set the current sow
            loadSowsForEditWithData(litter);
        }

        // Load sows for edit dropdown with litter data
        function loadSowsForEditWithData(litter) {
            fetch('/api/pigs/sows')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const sowSelect = document.getElementById('editSowSelect');
                    sowSelect.innerHTML = '<option value="">Select a sow</option>';
                    
                    data.sows.forEach(sow => {
                        const option = document.createElement('option');
                        option.value = sow.id;
                        option.textContent = `${sow.tag_id} - ${sow.breed || 'Unknown Breed'}`;
                        sowSelect.appendChild(option);
                    });

                    // Set the current sow as selected
                    if (litter && litter.sow_id) {
                        sowSelect.value = litter.sow_id;
                        console.log('Setting sow to:', litter.sow_id);
                    }
                }
            })
            .catch(error => {
                console.error('Error loading sows:', error);
            });
        }


        // Litter ID input handler
        function onLitterIdInput() {
            const input = document.getElementById('editLitterIdInput');
            const value = input.value;
            
            // More flexible format validation - allows E prefix and letters followed by numbers
            if (value && !value.match(/^[A-Za-z][A-Za-z0-9]*$/)) {
                input.classList.add('border-red-500');
                input.classList.remove('border-gray-300');
            } else {
                input.classList.remove('border-red-500');
                input.classList.add('border-gray-300');
            }
        }

        // Validate litter ID
        function validateLitterId() {
            const input = document.getElementById('editLitterIdInput');
            const value = input.value.trim();
            const messageDiv = document.getElementById('litterIdValidationMessage');
            const spinner = document.getElementById('validateLitterBtnSpinner');
            const text = document.getElementById('validateLitterBtnText');

            if (!value) {
                showValidationMessage('Please enter a litter ID', 'error');
                return;
            }

            if (!value.match(/^[A-Za-z][A-Za-z0-9]*$/)) {
                showValidationMessage('Litter ID must start with a letter and contain only letters and numbers', 'error');
                return;
            }

            // Show spinner
            spinner.classList.remove('hidden');
            text.classList.add('hidden');

            // Check if litter ID already exists (excluding current litter)
            const currentLitterId = document.getElementById('editLitterId').value;
            fetch(`/api/litter/check-id/${value}?exclude=${currentLitterId}`)
            .then(response => response.json())
            .then(data => {
                spinner.classList.add('hidden');
                text.classList.remove('hidden');

                if (data.exists) {
                    showValidationMessage('This litter ID is already in use', 'error');
                } else {
                    showValidationMessage('Litter ID is available', 'success');
                }
            })
            .catch(error => {
                spinner.classList.add('hidden');
                text.classList.remove('hidden');
                console.error('Error validating litter ID:', error);
                showValidationMessage('Error validating litter ID', 'error');
            });

            function showValidationMessage(message, type) {
                messageDiv.textContent = message;
                messageDiv.className = `mt-2 text-sm ${type === 'error' ? 'text-red-600' : 'text-green-600'}`;
                messageDiv.classList.remove('hidden');
            }
        }

        // Submit litter edit
        function submitLitterEdit() {
            const form = document.getElementById('editLitterForm');
            const formData = new FormData(form);
            
            // Validate required fields
            const litterId = formData.get('litter_id');
            const sowId = formData.get('sow_id');
            const farrowingDate = formData.get('farrowing_date');
            const alivePiglets = formData.get('alive_piglets');
            const status = formData.get('status');
            const weaningDate = formData.get('weaning_date');
            const weaningWeight = formData.get('weaning_weight');
            
            if (!litterId || !sowId || !farrowingDate || !alivePiglets) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate farrowing date is not in the future
            const farrowingDateObj = new Date(farrowingDate);
            const today = new Date();
            if (farrowingDateObj > today) {
                showToast('Farrowing date cannot be in the future', 'error');
                return;
            }

            // Validate litter ID format
            if (!litterId.match(/^[A-Za-z][A-Za-z0-9]*$/)) {
                showToast('Litter ID must start with a letter and contain only letters and numbers', 'error');
                return;
            }

            // Validate weaning fields if status is weaned
            if (status === 'weaned') {
                if (!weaningDate) {
                    showToast('Weaning date is required when status is "Weaned"', 'error');
                    return;
                }
                if (!weaningWeight || parseFloat(weaningWeight) <= 0) {
                    showToast('Weaning weight is required when status is "Weaned"', 'error');
                    return;
                }
                
                // Validate weaning date is not before farrowing date
                const weaningDateObj = new Date(weaningDate);
                if (weaningDateObj < farrowingDateObj) {
                    showToast('Weaning date cannot be before farrowing date', 'error');
                    return;
                }
            }

            // Prepare data for API
            const data = {
                litter_id: litterId,
                sow_id: parseInt(sowId),
                farrowing_date: farrowingDate,
                weaning_date: status === 'weaned' ? weaningDate : null,
                alive_piglets: parseInt(alivePiglets),
                weaning_weight: status === 'weaned' ? parseFloat(weaningWeight) : null,
                status: status
            };

            const currentLitterId = document.getElementById('editLitterId').value;

            fetch(`/api/litter/update/${currentLitterId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showToast(result.message, 'success');
                    closeEditLitterModal();
                    loadLitters(); // Refresh the litters list
                } else {
                    showToast(result.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error updating litter:', error);
                showToast('Error updating litter. Please try again.', 'error');
            });
        }

        // Close edit litter modal
        function closeEditLitterModal() {
            const modal = document.getElementById('editLitterModal');
            const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
            
            // Animate out
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            // Hide modal after animation
            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset styles for next time
                modalContent.style.transform = 'scale(0.95)';
                modalContent.style.opacity = '0';
            }, 300);
        }

        // Edit pig function
        function editPig(pigId) {
            fetch(`/api/pig/details/${pigId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Pig data loaded:', data.pig); // Debug log
                    currentPigData = data.pig;
                    populateEditForm(data.pig);
                    
                    // Show modal with animation
                    const modal = document.getElementById('editPigModal');
                    const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
                    modal.classList.remove('hidden');
                    
                    // Trigger animation after a small delay to ensure the modal is visible
                    setTimeout(() => {
                        modalContent.style.transform = 'scale(1)';
                        modalContent.style.opacity = '1';
                    }, 10);
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error loading pig details:', error);
                showToast('Error loading pig details', 'error');
            });
        }

        // Populate edit form with pig data
        function populateEditForm(pig) {
            console.log('Populating form with pig data:', pig); // Debug log
            
            document.getElementById('editPigId').value = pig.id;
            
            // Show the original tag ID (without E prefix) for editing
            const originalTagId = pig.tag_id.startsWith('E') ? pig.tag_id.substring(1) : pig.tag_id;
            console.log('Original tag ID:', originalTagId); // Debug log
            document.getElementById('editTagIdInput').value = originalTagId;
            
            document.getElementById('editFarmSelect').value = pig.farm_id;
            document.getElementById('editPigTypeSelect').value = pig.pig_type;
            document.getElementById('editPigSourceSelect').value = pig.pig_source;
            document.getElementById('editBreedInput').value = pig.breed || '';
            document.getElementById('editGenderSelect').value = pig.gender || '';
            document.getElementById('editPurposeSelect').value = pig.purpose || '';
            document.getElementById('editBreedingStatusDisplay').value = pig.breeding_status ? pig.breeding_status.charAt(0).toUpperCase() + pig.breeding_status.slice(1) : 'Not Set';
            
            // Ensure birth date is properly formatted and displayed
            console.log('Birth date from pig:', pig.birth_date); // Debug log
            if (pig.birth_date) {
                const birthDate = new Date(pig.birth_date);
                const formattedDate = birthDate.toISOString().split('T')[0];
                console.log('Formatted birth date:', formattedDate); // Debug log
                document.getElementById('editBirthDateInput').value = formattedDate;
            } else {
                console.log('No birth date found'); // Debug log
                document.getElementById('editBirthDateInput').value = '';
            }
            
            // Handle purchase date
            if (pig.purchase_date) {
                const purchaseDate = new Date(pig.purchase_date);
                const formattedPurchaseDate = purchaseDate.toISOString().split('T')[0];
                document.getElementById('editPurchaseDateInput').value = formattedPurchaseDate;
            } else {
                document.getElementById('editPurchaseDateInput').value = '';
            }
            
            document.getElementById('editStatusSelect').value = pig.status || 'active';
            
            // Show/hide conditional fields based on pig type
            toggleEditConditionalFields(pig.pig_type);
            
            // Show/hide purchase date field based on pig source
            const purchaseDateField = document.getElementById('editPurchaseDateField');
            if (pig.pig_source === 'purchased') {
                purchaseDateField.classList.remove('hidden');
            } else {
                purchaseDateField.classList.add('hidden');
            }
            
            // Clear any previous validation messages
            const validationMessage = document.getElementById('tagIdValidationMessage');
            if (validationMessage) {
                validationMessage.classList.add('hidden');
            }
        }

        // Toggle conditional fields in edit form
        function toggleEditConditionalFields(pigType) {
            const breedField = document.getElementById('editBreedField');
            const genderField = document.getElementById('editGenderField');
            const purposeField = document.getElementById('editPurposeField');
            const breedingStatusField = document.getElementById('editBreedingStatusField');
            
            if (pigType === 'grown_pig') {
                breedField.classList.remove('hidden');
                genderField.classList.remove('hidden');
                purposeField.classList.remove('hidden');
                breedingStatusField.classList.remove('hidden');
            } else {
                breedField.classList.add('hidden');
                genderField.classList.add('hidden');
                purposeField.classList.add('hidden');
                breedingStatusField.classList.add('hidden');
            }
        }

        // Toggle status reason field based on status changes
        function toggleStatusReasonField() {
            const statusSelect = document.getElementById('editStatusSelect');
            const reasonField = document.getElementById('statusReasonField');
            const currentStatus = currentPigData ? currentPigData.status : 'active';
            
            if (statusSelect.value !== currentStatus) {
                reasonField.classList.remove('hidden');
                document.getElementById('statusReasonInput').required = true;
            } else {
                reasonField.classList.add('hidden');
                document.getElementById('statusReasonInput').required = false;
                document.getElementById('statusReasonInput').value = '';
            }
        }

        // Handle pig type change in edit form
        document.getElementById('editPigTypeSelect').addEventListener('change', function() {
            toggleEditConditionalFields(this.value);
        });

        // Handle pig source change in edit form
        document.getElementById('editPigSourceSelect').addEventListener('change', function() {
            const purchaseDateField = document.getElementById('editPurchaseDateField');
            if (this.value === 'purchased') {
                purchaseDateField.classList.remove('hidden');
            } else {
                purchaseDateField.classList.add('hidden');
            }
        });

        // Real-time tag ID validation
        function onTagIdInput() {
            const tagIdInput = document.getElementById('editTagIdInput');
            const tagId = tagIdInput.value.trim();
            const validationMessage = document.getElementById('tagIdValidationMessage');
            
            // Hide previous validation message
            validationMessage.classList.add('hidden');
            
            if (!tagId) {
                return; // Don't show validation for empty field
            }
            
            // Basic format validation
            if (!tagId[0].match(/[A-Za-z]/) || !tagId.slice(1).match(/^\d+$/)) {
                showValidationMessage('Tag ID must start with a letter followed by numbers', 'error');
                return;
            }
            
            // Show format is valid
            showValidationMessage('Format is valid. Click Validate to check availability.', 'info');
        }

        // Tag ID validation function
        async function validateTagId() {
            const tagIdInput = document.getElementById('editTagIdInput');
            const tagId = tagIdInput.value.trim();
            const currentPigId = document.getElementById('editPigId').value;
            const validateBtn = document.getElementById('validateTagIdBtn');
            const validateBtnText = document.getElementById('validateBtnText');
            const validateBtnSpinner = document.getElementById('validateBtnSpinner');
            
            if (!tagId) {
                showValidationMessage('Tag ID is required', 'error');
                return;
            }
            
            // Basic format validation
            if (!tagId[0].match(/[A-Za-z]/) || !tagId.slice(1).match(/^\d+$/)) {
                showValidationMessage('Tag ID must start with a letter followed by numbers', 'error');
                return;
            }
            
            // Show loading state
            validateBtn.disabled = true;
            validateBtnText.classList.add('hidden');
            validateBtnSpinner.classList.remove('hidden');
            
            try {
                const response = await fetch('/api/pig/validate-tag-id', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tag_id: tagId,
                        current_pig_id: currentPigId
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showValidationMessage(result.message, 'success');
                } else {
                    showValidationMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('Error validating tag ID:', error);
                showValidationMessage('Error validating tag ID. Please try again.', 'error');
            } finally {
                // Hide loading state
                validateBtn.disabled = false;
                validateBtnText.classList.remove('hidden');
                validateBtnSpinner.classList.add('hidden');
            }
        }

        // Show validation message
        function showValidationMessage(message, type) {
            const validationMessage = document.getElementById('tagIdValidationMessage');
            validationMessage.textContent = message;
            
            let colorClass = '';
            switch(type) {
                case 'success':
                    colorClass = 'text-green-600 dark:text-green-400';
                    break;
                case 'error':
                    colorClass = 'text-red-600 dark:text-red-400';
                    break;
                case 'info':
                    colorClass = 'text-blue-600 dark:text-blue-400';
                    break;
                default:
                    colorClass = 'text-gray-600 dark:text-gray-400';
            }
            
            validationMessage.className = `mt-2 text-sm ${colorClass}`;
            validationMessage.classList.remove('hidden');
        }

        // Submit pig edit
        function submitPigEdit() {
            const form = document.getElementById('editPigForm');
            const formData = new FormData(form);
            
            // Validate required fields
            const farmId = formData.get('farm_id');
            const pigType = formData.get('pig_type');
            const pigSource = formData.get('pig_source');
            const birthDate = formData.get('birth_date');
            
            if (!farmId || !pigType || !pigSource || !birthDate) {
                showToast('Please fill in all required fields including birth date', 'error');
                return;
            }
            
            // Validate birth date is not in the future
            const birthDateObj = new Date(birthDate);
            const today = new Date();
            if (birthDateObj > today) {
                showToast('Birth date cannot be in the future', 'error');
                return;
            }
            
            if (pigSource === 'purchased' && !formData.get('purchase_date')) {
                showToast('Purchase date is required for purchased pigs', 'error');
                return;
            }

            if (pigType === 'grown_pig') {
                const breed = formData.get('breed');
                const gender = formData.get('gender');
                const purpose = formData.get('purpose');
                
                if (!breed || !gender || !purpose) {
                    const missingFields = [];
                    if (!breed) missingFields.push('Breed');
                    if (!gender) missingFields.push('Gender');
                    if (!purpose) missingFields.push('Purpose');
                    
                    showToast(`Please fill in all required fields for grown pigs: ${missingFields.join(', ')}`, 'error');
                    return;
                }
                
                // Additional validation for breeding pigs
                if (purpose === 'breeding' && !breed.trim()) {
                    showToast('Breed is required for breeding pigs', 'error');
                    return;
                }
            }

            // Validate tag ID
            const tagId = formData.get('tag_id').trim();
            if (!tagId) {
                showToast('Tag ID is required', 'error');
                return;
            }
            
            // Basic format validation
            if (!tagId[0].match(/[A-Za-z]/) || !tagId.slice(1).match(/^\d+$/)) {
                showToast('Tag ID must start with a letter followed by numbers', 'error');
                return;
            }

            // Validate status reason if status is changing
            const currentStatus = currentPigData ? currentPigData.status : 'active';
            const newStatus = formData.get('status');
            const statusReason = formData.get('status_reason');
            
            if (newStatus !== currentStatus && (!statusReason || statusReason.trim() === '')) {
                showToast('Please provide a reason for the status change', 'error');
                document.getElementById('statusReasonInput').focus();
                return;
            }
            
            // Prepare data for API
            const data = {
                tag_id: tagId,
                farm_id: parseInt(farmId),
                pig_type: pigType,
                pig_source: pigSource,
                breed: formData.get('breed') || null,
                gender: formData.get('gender') || null,
                purpose: formData.get('purpose') || null,
                birth_date: birthDate,
                purchase_date: formData.get('purchase_date') || null,
                status: formData.get('status'),
                status_reason: formData.get('status_reason') || null
            };

            fetch(`/api/pig/update/${currentPigData.id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showToast(result.message, 'success');
                    closeEditPigModal();
                    showChangesSummary(result.changes);
                    
                    // Refresh the pigs list and recalculate ages
                    setTimeout(function() {
                        loadPigs();
                        recalculateAllPigAges();
                    }, 500);
                } else {
                    showToast(result.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error updating pig:', error);
                showToast('Error updating pig. Please try again.', 'error');
            });
        }

        // Close edit pig modal
        function closeEditPigModal() {
            const modal = document.getElementById('editPigModal');
            const modalContent = modal.querySelector('.bg-white, .dark\\:bg-gray-800');
            
            // Animate out
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            // Hide modal after animation
            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset styles for next time
                modalContent.style.transform = 'scale(0.95)';
                modalContent.style.opacity = '0';
            }, 300);
            
            currentPigData = null;
        }

        // Show changes summary modal
        function showChangesSummary(changes) {
            const content = document.getElementById('changesSummaryContent');
            content.innerHTML = changes.map(change => `
                <div class="flex items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700">
                    <svg class="w-4 h-4 text-green-600 dark:text-green-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-green-800 dark:text-green-200">${change}</span>
                </div>
            `).join('');
            
            document.getElementById('changesSummaryModal').classList.remove('hidden');
        }

        // Close changes summary modal
        function closeChangesSummaryModal() {
            document.getElementById('changesSummaryModal').classList.add('hidden');
        }

        // View audit trail for a pig
        function viewAuditTrail(pigId) {
            fetch(`/api/pig/audit-trail/${pigId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    populateAuditTrail(data.pig, data.audit_trail);
                    document.getElementById('auditTrailModal').classList.remove('hidden');
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error loading audit trail:', error);
                showToast('Error loading audit trail. Please try again.', 'error');
            });
        }

        // Populate audit trail modal
        function populateAuditTrail(pig, auditTrail) {
            // Set pig information
            document.getElementById('auditPigTagId').textContent = pig.tag_id;
            document.getElementById('auditPigTagIdInfo').textContent = pig.tag_id;
            document.getElementById('auditPigFarm').textContent = pig.farm_name || 'Unknown';
            document.getElementById('auditPigType').textContent = pig.pig_type ? pig.pig_type.replace('_', ' ') : 'Unknown';
            document.getElementById('auditPigStatus').textContent = pig.status || 'Unknown';

            // Populate audit trail content
            const content = document.getElementById('auditTrailContent');
            
            if (auditTrail.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-lg font-medium">No changes recorded yet</p>
                        <p class="text-sm">This pig has no recorded changes in the system.</p>
                    </div>
                `;
            } else {
                content.innerHTML = auditTrail.map(entry => {
                    const activityIcon = getActivityIcon(entry.activity_type);
                    const activityColor = getActivityColor(entry.activity_type);
                    
                    return `
                        <div class="flex items-start p-4 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm">
                            <div class="flex-shrink-0 mr-4">
                                <div class="w-8 h-8 rounded-full ${activityColor} flex items-center justify-center">
                                    ${activityIcon}
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">
                                        ${getActivityDisplayName(entry.activity_type)}
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        ${entry.timestamp}
                                    </p>
                                </div>
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    ${entry.description}
                                </p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <span class="mr-3">By: ${entry.employee_name} (${entry.employee_role})</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Get activity icon based on activity type
        function getActivityIcon(activityType) {
            const icons = {
                'PIG_REGISTRATION': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>',
                'PIG_UPDATE': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>',
                'PIG_STATUS_CHANGE': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'BREEDING_REGISTRATION': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>',
                'BREEDING_CANCELLATION': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
                'FARROWING_ACTIVITY_COMPLETED': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'BREEDING_CYCLE_COMPLETED': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>',
                'LITTER_REGISTRATION': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>',
                'LITTER_POSTPONED': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'LOGIN': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path></svg>',
                'LOGOUT': '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4"></path></svg>'
            };
            return icons[activityType] || '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        }

        // Get activity color based on activity type
        function getActivityColor(activityType) {
            const colors = {
                'PIG_REGISTRATION': 'bg-green-500',
                'PIG_UPDATE': 'bg-blue-500',
                'PIG_STATUS_CHANGE': 'bg-amber-500',
                'BREEDING_REGISTRATION': 'bg-pink-500',
                'BREEDING_CANCELLATION': 'bg-red-500',
                'FARROWING_ACTIVITY_COMPLETED': 'bg-yellow-500',
                'BREEDING_CYCLE_COMPLETED': 'bg-purple-500',
                'LITTER_REGISTRATION': 'bg-indigo-500',
                'LITTER_POSTPONED': 'bg-orange-500',
                'LOGIN': 'bg-emerald-500',
                'LOGOUT': 'bg-orange-500'
            };
            return colors[activityType] || 'bg-gray-500';
        }

        // Get activity display name based on activity type
        function getActivityDisplayName(activityType) {
            const names = {
                'PIG_REGISTRATION': 'Pig Registered',
                'PIG_UPDATE': 'Pig Updated',
                'PIG_STATUS_CHANGE': 'Status Changed',
                'BREEDING_REGISTRATION': 'Breeding Registered',
                'BREEDING_CANCELLATION': 'Breeding Cancelled',
                'FARROWING_ACTIVITY_COMPLETED': 'Farrowing Activity Completed',
                'BREEDING_CYCLE_COMPLETED': 'Breeding Cycle Completed',
                'LITTER_REGISTRATION': 'Litter Registered',
                'LITTER_POSTPONED': 'Litter Postponed',
                'LOGIN': 'User Login',
                'LOGOUT': 'User Logout'
            };
            return names[activityType] || 'Activity';
        }

        // Close audit trail modal
        function closeAuditTrailModal() {
            document.getElementById('auditTrailModal').classList.add('hidden');
        }

        // Litter Registration Functions
        let currentLitterData = null;

        // Show litter registration modal for completed breeding cycle
        function showLitterRegistration(breedingRecord) {
            currentLitterData = breedingRecord;
            populateLitterForm(breedingRecord);
            document.getElementById('litterRegistrationModal').classList.remove('hidden');
        }

        // Populate litter registration form
        function populateLitterForm(breedingRecord) {
            // Set sow information
            document.getElementById('litterSowTagId').textContent = breedingRecord.sow_tag_id;
            document.getElementById('litterSowTagIdInfo').textContent = breedingRecord.sow_tag_id;
            document.getElementById('litterSowBreed').textContent = breedingRecord.sow_breed || 'Unknown';
            document.getElementById('litterSowAge').textContent = breedingRecord.sow_age_days ? breedingRecord.sow_age_days + ' days' : 'Unknown';
            document.getElementById('litterSowFarm').textContent = breedingRecord.sow_farm_name || 'Unknown';

            // Set breeding record information
            document.getElementById('litterMatingDate').textContent = breedingRecord.mating_date ? new Date(breedingRecord.mating_date).toLocaleDateString() : 'Unknown';
            document.getElementById('litterExpectedFarrowing').textContent = breedingRecord.expected_farrowing ? new Date(breedingRecord.expected_farrowing).toLocaleDateString() : 'Unknown';
            document.getElementById('litterBoarUsed').textContent = breedingRecord.boar_tag_id || 'Unknown';

            // Set hidden fields
            document.getElementById('litterSowId').value = breedingRecord.sow_id;
            document.getElementById('litterBreedingRecordId').value = breedingRecord.id;

            // Set default farrowing date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('litterFarrowingDate').value = today;

            // Generate next litter ID
            generateNextLitterId();
        }

        // Generate next available litter ID
        function generateNextLitterId() {
            fetch('/api/litter/next-id')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('litterIdInput').value = data.next_litter_id;
                }
            })
            .catch(error => {
                console.error('Error generating litter ID:', error);
            });
        }

        // Register litter
        function registerLitter() {
            const form = document.getElementById('litterRegistrationForm');
            const formData = new FormData(form);

            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Validate alive piglets vs total piglets
            const totalPiglets = parseInt(formData.get('total_piglets'));
            const alivePiglets = parseInt(formData.get('alive_piglets'));
            const stillBirths = parseInt(formData.get('still_births') || 0);

            if (alivePiglets + stillBirths > totalPiglets) {
                showToast('Alive piglets + still births cannot exceed total piglets', 'error');
                return;
            }

            // Prepare data
            const data = {
                sow_id: formData.get('sow_id'),
                breeding_record_id: formData.get('breeding_record_id'),
                litter_id: formData.get('litter_id'),
                farrowing_date: formData.get('farrowing_date'),
                total_piglets: totalPiglets,
                alive_piglets: alivePiglets,
                still_births: stillBirths,
                avg_weight: formData.get('avg_weight') || null,
                notes: formData.get('notes') || null
            };

            // Submit litter registration
            fetch('/api/litter/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showToast(result.message, 'success');
                    closeLitterRegistrationModal();
                    
                    // Refresh the pigs list
                    setTimeout(function() {
                        loadPigs();
                    }, 500);
                } else {
                    showToast(result.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error registering litter:', error);
                showToast('Error registering litter. Please try again.', 'error');
            });
        }

        // Postpone litter registration
        function postponeLitterRegistration() {
            document.getElementById('postponeReasonModal').classList.remove('hidden');
        }

        // Confirm postponement
        function confirmPostpone() {
            const reason = document.getElementById('postponeReasonInput').value.trim();
            
            if (!reason) {
                showToast('Please provide a reason for postponement', 'error');
                document.getElementById('postponeReasonInput').focus();
                return;
            }

            // Submit postponement
            fetch('/api/litter/postpone', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    breeding_record_id: currentLitterData.id,
                    reason: reason
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showToast(result.message, 'success');
                    closePostponeReasonModal();
                    closeLitterRegistrationModal();
                    
                    // Refresh the pigs list
                    setTimeout(function() {
                        loadPigs();
                    }, 500);
                } else {
                    showToast(result.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error postponing litter registration:', error);
                showToast('Error postponing litter registration. Please try again.', 'error');
            });
        }

        // Close litter registration modal
        function closeLitterRegistrationModal() {
            document.getElementById('litterRegistrationModal').classList.add('hidden');
            currentLitterData = null;
            document.getElementById('litterRegistrationForm').reset();
        }

        // Close postpone reason modal
        function closePostponeReasonModal() {
            document.getElementById('postponeReasonModal').classList.add('hidden');
            document.getElementById('postponeReasonInput').value = '';
        }

        // Check for completed breeding cycles
        function checkCompletedBreedingCycles() {
            fetch('/api/breeding/completed-cycles')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.completed_cycles && data.completed_cycles.length > 0) {
                    // Show litter registration for the first completed cycle
                    const completedCycle = data.completed_cycles[0];
                    showLitterRegistration(completedCycle);
                }
            })
            .catch(error => {
                console.error('Error checking completed breeding cycles:', error);
            });
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupMobileMenu();
            
            // Initialize theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleDarkMode);
            }
            
            // Initialize user dropdown
            const userDropdownBtn = document.getElementById('user-dropdown-btn');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (userDropdownBtn && userDropdown) {
                userDropdownBtn.addEventListener('click', () => {
                    userDropdown.classList.toggle('hidden');
                });
                
                document.addEventListener('click', (e) => {
                    if (!userDropdownBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
            }
            
            // Initialize logout button
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to logout?')) {
                        window.location.href = '/logout';
                    }
                });
            }
            
            // Load initial data
            loadPigs();
            loadLitters();
        });

        // Toast notification function
        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium shadow-lg transform transition-all duration-300 translate-x-full`;
            
            // Set color based on type
            if (type === 'success') {
                toast.classList.add('bg-green-500');
            } else if (type === 'error') {
                toast.classList.add('bg-red-500');
            } else {
                toast.classList.add('bg-blue-500');
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
