<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breeding Management - Pig Farm Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    screens: {
                        'xs': '475px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '2xl': '1536px',
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        },
                        accent: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-4px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.closed {
            transform: translateX(-100%);
        }
        @media (min-width: 768px) {
            .sidebar.closed {
                transform: translateX(0);
            }
        }
        
        /* Custom animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -8px, 0);
            }
            70% {
                transform: translate3d(0, -4px, 0);
            }
            90% {
                transform: translate3d(0, -2px, 0);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .animate-slideInRight {
            animation: slideInRight 0.6s ease-out forwards;
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        /* Enhanced hover effects */
        .group:hover .group-hover\:scale-110 {
            transform: scale(1.1);
        }
        
        .group:hover .group-hover\:rotate-180 {
            transform: rotate(180deg);
        }
        
        /* Progress bar animation */
        .progress-bar {
            transition: width 1s ease-in-out;
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #f59e0b, #ef4444);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #d97706, #dc2626);
        }
        
        /* Custom scrollbar for sidebar */
        .scrollbar-thin {
            scrollbar-width: thin;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.3);
            border-radius: 2px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.5);
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(75, 85, 99, 0.3);
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(75, 85, 99, 0.5);
        }
        
        /* Enhanced sidebar animations */
        .sidebar-link {
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .sidebar-link:hover::before {
            left: 100%;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .group {
                padding: 0.75rem;
            }
            
            .text-3xl {
                font-size: 1.5rem;
            }
            
            .text-4xl {
                font-size: 1.875rem;
            }
            
            .text-2xl {
                font-size: 1.25rem;
            }
            
            /* Ensure proper spacing on mobile */
            .space-y-3 > * + * {
                margin-top: 0.5rem;
            }
            
            .space-y-4 > * + * {
                margin-top: 0.75rem;
            }
            
            /* Better button sizing on mobile */
            .px-3 {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .py-2 {
                padding-top: 0.375rem;
                padding-bottom: 0.375rem;
            }
            
            /* Mobile sidebar improvements */
            #sidebar {
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }
        }
        
        /* Responsive sidebar width */
        @media (min-width: 768px) {
            #sidebar {
                width: 16rem; /* 256px - consistent width */
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .group {
                padding: 0.5rem;
            }
            
            .text-2xl {
                font-size: 1.125rem;
            }
            
            .text-3xl {
                font-size: 1.25rem;
            }
            
            .text-4xl {
                font-size: 1.5rem;
            }
            
            /* Stack navigation buttons vertically on very small screens */
            .flex-col {
                flex-direction: column;
            }
            
            .space-x-2 > * + * {
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 641px) and (max-width: 1024px) {
            .group {
                padding: 1rem;
            }
            
            .text-3xl {
                font-size: 1.75rem;
            }
            
            .text-4xl {
                font-size: 2rem;
            }
        }
        
        /* Large screen optimizations */
        @media (min-width: 1280px) {
            .group {
                padding: 1.5rem;
            }
        }
        
        /* Ultra-wide screen optimizations */
        @media (min-width: 1536px) {
            .group {
                padding: 2rem;
            }
        }
        
        /* Dark mode enhancements */
        .dark .glass {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 via-pink-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 transition-all duration-300 ease-in-out">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 shadow-2xl transform -translate-x-full transition-all duration-300 ease-in-out md:translate-x-0 border-r border-gray-200 dark:border-gray-700">
        <!-- Sidebar Header -->
        <div class="flex items-center justify-between h-20 px-6 bg-gradient-to-br from-pink-600 via-purple-700 to-blue-800 shadow-lg">
                <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-heart text-white text-xl"></i>
                        </div>
                <div>
                    <h1 class="text-xl font-bold text-white tracking-tight">PigFarm Pro</h1>
                    <p class="text-sm text-white/90 font-medium">Breeding Management</p>
                    </div>
                    </div>
            <button id="close-sidebar" class="md:hidden text-white/80 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-all duration-200" aria-label="Close sidebar">
                <i class="fas fa-times text-lg"></i>
                </button>
                            </div>

        <!-- Sidebar Navigation -->
        <nav class="mt-8 px-4">
            <div class="space-y-2">
                <!-- Breeding Management (Active) -->
                <a href="/admin/farm/breeding-management" class="group flex items-center px-4 py-4 bg-gradient-to-r from-pink-50 via-purple-100 to-blue-50 dark:from-pink-900/40 dark:via-purple-900/40 dark:to-blue-900/40 text-pink-700 dark:text-pink-300 rounded-xl shadow-lg border border-pink-200 dark:border-pink-700/50 relative overflow-hidden" role="menuitem" aria-current="page">
                    <div class="absolute inset-0 bg-gradient-to-r from-pink-500/10 to-purple-500/10"></div>
                    <div class="w-12 h-12 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-500 rounded-xl flex items-center justify-center shadow-lg mr-4 group-hover:scale-110 transition-transform duration-200 relative z-10">
                        <i class="fas fa-heart text-white text-lg"></i>
                                </div>
                    <div class="flex-1 relative z-10">
                        <span class="font-bold text-sm text-gray-900 dark:text-white block">Breeding Management</span>
                        <span class="text-xs text-pink-600 dark:text-pink-400 font-medium">Active Page</span>
                                </div>
                    <div class="w-2 h-2 bg-pink-500 rounded-full animate-pulse-slow"></div>
                </a>

                <!-- Breeding Records -->
                <a href="/admin/farm/breeding-records" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" role="menuitem">
                    <div class="w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-clipboard-list text-gray-600 dark:text-gray-400 text-lg"></i>
                        </div>
                    <div class="flex-1">
                        <span class="font-semibold text-sm">Breeding Records</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Active & Pregnant</p>
                        </div>
                </a>

                <!-- Failed Conceptions -->
                <a href="/admin/farm/failed-conceptions" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" role="menuitem">
                    <div class="w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-times-circle text-gray-600 dark:text-gray-400 text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <span class="font-semibold text-sm">Failed Conceptions</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Failed Attempts</p>
                    </div>
                </a>

                <!-- Completed Farrowings -->
                <a href="/admin/farm/completed-farrowings" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" role="menuitem">
                    <div class="w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-check-circle text-gray-600 dark:text-gray-400 text-lg"></i>
                        </div>
                    <div class="flex-1">
                        <span class="font-semibold text-sm">Completed Farrowings</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Successful Births</p>
                        </div>
                </a>

                <!-- Family Tree -->
                <a href="/admin/farm/family-tree" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" role="menuitem">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/30 dark:to-purple-800/30 rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-sitemap text-purple-600 dark:text-purple-400 text-lg"></i>
                        </div>
                    <div class="flex-1">
                        <span class="font-semibold text-sm">Family Tree</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Pedigree View</p>
                        </div>
                </a>

                <!-- Dashboard -->
                <a href="/admin/dashboard" class="group flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" role="menuitem">
                    <div class="w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-chart-line text-gray-600 dark:text-gray-400 text-lg"></i>
                        </div>
                    <div class="flex-1">
                        <span class="font-semibold text-sm">Dashboard</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Overview</p>
                        </div>
                    </a>
                </div>
            </nav>
            
            <!-- Sidebar Footer -->
        <div class="absolute bottom-0 left-0 right-0 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gradient-to-br from-accent-500 to-accent-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-user text-white text-lg"></i>
                        </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold text-gray-900 dark:text-white truncate">Admin User</p>
                    <p class="text-xs text-gray-600 dark:text-gray-400 font-medium">Administrator</p>
                    <div class="flex items-center mt-1">
                        <div class="w-2 h-2 bg-accent-500 rounded-full mr-2"></div>
                        <span class="text-xs text-accent-600 dark:text-accent-400 font-medium">Online</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Mobile Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden md:hidden transition-opacity duration-300"></div>

    <!-- Main Content -->
    <main class="md:ml-72 min-h-screen bg-gradient-to-br from-gray-50 via-pink-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 transition-all duration-300 ease-in-out">
        <div class="p-6 lg:p-8">
            <!-- Page Header -->
            <div class="mb-8 animate-fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Header Background -->
                    <div class="h-2 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500"></div>
                    
                    <div class="p-8">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-6 lg:space-y-0">
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-heart text-white text-2xl"></i>
                            </div>
                            <div>
                                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight">Breeding Management</h1>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium mt-1">Manage breeding programs and monitor litter status</p>
                                    <div class="flex items-center mt-2">
                                        <div class="w-2 h-2 bg-pink-500 rounded-full mr-2 animate-pulse"></div>
                                        <span class="text-sm text-pink-600 dark:text-pink-400 font-medium">Active Management</span>
                            </div>
                        </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                            <!-- Mobile Menu Button -->
                                <button id="mobile-menu-btn" class="lg:hidden p-3 text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Open menu">
                                    <i class="fas fa-bars text-lg"></i>
                            </button>
                            
                                <!-- Refresh Button -->
                                <button onclick="refreshAllData()" class="group p-3 text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md hover:-translate-y-0.5" aria-label="Refresh data">
                                    <i class="fas fa-sync-alt text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                            </button>
                                
                                <!-- Dark Mode Toggle -->
                                <button onclick="toggleDarkMode()" class="p-3 text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Toggle dark mode">
                                    <i class="fas fa-moon dark:hidden text-lg"></i>
                                    <i class="fas fa-sun hidden dark:block text-lg"></i>
                                </button>
                                
                                <!-- New Breeding Button -->
                                <button id="new-breeding-btn" class="group inline-flex items-center px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white text-sm font-semibold rounded-xl transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5">
                                    <div class="w-6 h-6 bg-white/20 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-200">
                                        <i class="fas fa-plus text-sm"></i>
                                </div>
                                    <span>New Breeding</span>
                            </button>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-8 animate-slide-up">
                <!-- Available Sows Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-500/5 to-pink-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-pink-100 to-pink-200 dark:from-pink-900/30 dark:to-pink-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-female text-pink-600 dark:text-pink-400 text-sm"></i>
                        </div>
                            <div class="w-2 h-2 bg-pink-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Available Sows</p>
                            <p id="available-sows-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-pink-600 dark:text-pink-400 font-medium">Ready for breeding</p>
                        </div>
                    </div>
                </div>

                <!-- Available Boars Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-blue-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-male text-blue-600 dark:text-blue-400 text-sm"></i>
                        </div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Available Boars</p>
                            <p id="available-boars-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-blue-600 dark:text-blue-400 font-medium">Ready for breeding</p>
                        </div>
                    </div>
                </div>

                <!-- Served Sows Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-green-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-heart text-green-600 dark:text-green-400 text-sm"></i>
                        </div>
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Served Sows</p>
                            <p id="active-breeding-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-green-600 dark:text-green-400 font-medium">>93 days to farrowing</p>
                        </div>
                    </div>
                </div>

                <!-- Pregnant Sows Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-purple-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/30 dark:to-purple-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-baby text-purple-600 dark:text-purple-400 text-sm"></i>
                        </div>
                            <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Pregnant Sows</p>
                            <p id="pregnant-sows-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-purple-600 dark:text-purple-400 font-medium">≤93 days to farrowing</p>
                        </div>
                    </div>
                </div>

                <!-- Failed Conceptions Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-red-500/5 to-red-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/30 dark:to-red-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-times-circle text-red-600 dark:text-red-400 text-sm"></i>
                        </div>
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Failed Conceptions</p>
                            <p id="failed-conceptions-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-red-600 dark:text-red-400 font-medium">Moved to other records</p>
                        </div>
                    </div>
                </div>

                <!-- Completed Farrowings Card -->
                <div class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-emerald-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-emerald-600 dark:text-emerald-400 text-sm"></i>
                            </div>
                            <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Completed Farrowings</p>
                            <p id="completed-farrowings-count" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-emerald-600 dark:text-emerald-400 font-medium">Successful births</p>
                        </div>
                        </div>
                    </div>
            </div>

            <!-- Available Sows Section -->
            <div class="mb-8 animate-slide-up">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Section Header -->
                    <div class="px-8 py-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-pink-50 dark:from-gray-800 dark:to-pink-900/20">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Available Sows</h2>
                                <p class="text-gray-600 dark:text-gray-400 font-medium mt-1">Sows ready for breeding - select from the cards below</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <!-- Search Bar -->
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-gray-400"></i>
                                    </div>
                                    <input type="text" id="search-sows" placeholder="Search sows..." 
                                           class="pl-12 pr-4 py-3 w-full lg:w-80 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm font-medium transition-all duration-200" 
                                           aria-label="Search sows">
                                </div>
                                
                                <!-- Refresh Button -->
                                <button onclick="loadAvailableSows()" class="group p-3 text-gray-600 dark:text-gray-400 hover:text-pink-600 dark:hover:text-pink-400 hover:bg-pink-50 dark:hover:bg-pink-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Refresh sows">
                                    <i class="fas fa-sync-alt text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sows Container -->
                    <div id="sows-container" class="p-6">
                        <!-- Mobile Grid Layout -->
                        <div class="block lg:hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <!-- Loading state -->
                            <div class="col-span-full flex items-center justify-center py-12">
                                            <div class="text-center">
                                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500 mx-auto mb-2"></div>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Loading sows...</p>
                                            </div>
                                        </div>
                        </div>
                        
                        <!-- Desktop List Layout -->
                        <div class="hidden lg:block divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Loading state -->
                            <div class="flex items-center justify-center py-12">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500 mx-auto mb-2"></div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Loading sows...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Available Boars Section -->
            <div class="mb-8 animate-slide-up">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Section Header -->
                    <div class="px-8 py-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900/20">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Available Boars</h2>
                                <p class="text-gray-600 dark:text-gray-400 font-medium mt-1">Boars ready for breeding - select from the cards below</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <!-- Search Bar -->
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-gray-400"></i>
                                    </div>
                                    <input type="text" id="search-boars" placeholder="Search boars..." 
                                           class="pl-12 pr-4 py-3 w-full lg:w-80 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-medium transition-all duration-200" 
                                           aria-label="Search boars">
                                </div>
                                
                                <!-- Refresh Button -->
                                <button onclick="loadAvailableBoars()" class="group p-3 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all duration-200 hover:shadow-md" aria-label="Refresh boars">
                                    <i class="fas fa-sync-alt text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Boars Container -->
                    <div id="boars-container" class="p-6">
                        <!-- Mobile Grid Layout -->
                        <div class="block lg:hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <!-- Loading state -->
                            <div class="col-span-full flex items-center justify-center py-12">
                                            <div class="text-center">
                                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Loading boars...</p>
                                            </div>
                                        </div>
                        </div>
                        
                        <!-- Desktop List Layout -->
                        <div class="hidden lg:block divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Loading state -->
                            <div class="flex items-center justify-center py-12">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Loading boars...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </main>

    <!-- New Breeding Modal -->
    <div id="new-breeding-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-start sm:items-center justify-center min-h-screen p-1 sm:p-4 overflow-y-auto">
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-3xl shadow-2xl w-full max-w-3xl mx-1 sm:mx-4 my-2 sm:my-4 max-h-[98vh] sm:max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="relative px-3 sm:px-6 lg:px-8 py-3 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="absolute inset-0 bg-gradient-to-r from-pink-500/5 via-purple-500/5 to-blue-500/5 rounded-t-xl sm:rounded-t-3xl"></div>
                    <div class="relative flex items-center justify-between">
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-600 rounded-lg sm:rounded-2xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-heart text-white text-sm sm:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-2xl font-bold text-gray-900 dark:text-white">New Breeding Record</h3>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 font-medium">Create a new breeding program entry</p>
                            </div>
                        </div>
                        <button id="close-new-breeding-modal" class="p-1 sm:p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg sm:rounded-xl transition-all duration-200">
                            <i class="fas fa-times text-sm sm:text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Form -->
                <form id="new-breeding-form" class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 lg:py-8 space-y-4 sm:space-y-6">
                    <!-- Sow Selection -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-female text-pink-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Select Sow
                        </label>
                        <div class="relative">
                            <select id="sow-select" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-pink-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-pink-300 dark:hover:border-pink-500 appearance-none cursor-pointer text-xs sm:text-base">
                                <option value="">Choose a sow from available options...</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:pr-4 pointer-events-none">
                                <i class="fas fa-chevron-down text-gray-400 text-xs sm:text-sm"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Boar Selection -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-male text-blue-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Select Boar
                        </label>
                        <div class="relative">
                            <select id="boar-select" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-blue-300 dark:hover:border-blue-500 appearance-none cursor-pointer text-xs sm:text-base">
                                <option value="">Choose a boar from available options...</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:pr-4 pointer-events-none">
                                <i class="fas fa-chevron-down text-gray-400 text-xs sm:text-sm"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mating Date -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-calendar-alt text-purple-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Mating Date
                        </label>
                        <input type="date" id="mating-date" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-purple-300 dark:hover:border-purple-500 text-xs sm:text-base" required>
                    </div>
                    
                    <!-- Additional Notes -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-sticky-note text-green-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Additional Notes
                        </label>
                        <textarea id="breeding-notes" rows="3" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 resize-none text-xs sm:text-base" placeholder="Enter any additional notes or observations about the breeding process..."></textarea>
                    </div>
                    
                    <!-- Info Box -->
                    <div class="relative bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200/50 dark:border-blue-700/50 rounded-lg sm:rounded-2xl p-3 sm:p-6">
                        <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 rounded-lg sm:rounded-2xl"></div>
                        <div class="relative flex items-start space-x-2 sm:space-x-3">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 mt-0.5 sm:mt-1">
                                <i class="fas fa-info-circle text-white text-xs sm:text-sm"></i>
                            </div>
                            <div class="space-y-1 sm:space-y-2">
                                <p class="text-xs sm:text-sm font-semibold text-blue-800 dark:text-blue-200">Important Information</p>
                                <p class="text-xs sm:text-sm text-blue-700 dark:text-blue-300 leading-relaxed">After creating the breeding record, the sow's status will be updated to "served" and you'll be able to track the pregnancy progress.</p>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- Modal Footer -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-xl sm:rounded-b-3xl">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 lg:space-x-6">
                        <button id="cancel-breeding-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:scale-105 font-medium text-xs sm:text-sm">
                            <i class="fas fa-times mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            <span class="group-hover:translate-x-1 transition-transform">Cancel</span>
                        </button>
                        <button id="save-breeding-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white rounded-lg sm:rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold text-xs sm:text-sm">
                            <i class="fas fa-heart mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            <span class="group-hover:translate-x-1 transition-transform">Create Breeding Record</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancel Breeding Modal -->
    <div id="cancel-breeding-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-start sm:items-center justify-center min-h-screen p-1 sm:p-4 overflow-y-auto">
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-3xl shadow-2xl w-full max-w-lg mx-1 sm:mx-4 my-2 sm:my-4 max-h-[98vh] sm:max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="relative px-3 sm:px-6 lg:px-8 py-3 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="absolute inset-0 bg-gradient-to-r from-red-500/5 via-orange-500/5 to-yellow-500/5 rounded-t-xl sm:rounded-t-3xl"></div>
                    <div class="relative flex items-center justify-between">
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg sm:rounded-2xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-times-circle text-white text-sm sm:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-2xl font-bold text-gray-900 dark:text-white">Cancel Conception</h3>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 font-medium">Register breeding failure and update status</p>
                            </div>
                        </div>
                        <button id="close-cancel-breeding-modal" class="p-1 sm:p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg sm:rounded-xl transition-all duration-200">
                            <i class="fas fa-times text-sm sm:text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Form -->
                <form id="cancel-breeding-form" class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 lg:py-8 space-y-4 sm:space-y-6">
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">Failure Reason</label>
                        <textarea id="cancellation-reason" rows="3" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-red-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-red-300 dark:hover:border-red-500 resize-none text-xs sm:text-base" placeholder="Please provide detailed information about why the sow failed to conceive (e.g., health issues, timing problems, environmental factors, etc.)..." required></textarea>
                    </div>
                    
                    <!-- Warning Box -->
                    <div class="relative bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border border-yellow-200/50 dark:border-yellow-700/50 rounded-lg sm:rounded-2xl p-3 sm:p-6">
                        <div class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-orange-500/5 rounded-lg sm:rounded-2xl"></div>
                        <div class="relative flex items-start space-x-2 sm:space-x-3">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 mt-0.5 sm:mt-1">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <div class="space-y-1 sm:space-y-2">
                                <p class="text-xs sm:text-sm font-semibold text-yellow-800 dark:text-yellow-200">Important Information</p>
                                <p class="text-xs sm:text-sm text-yellow-700 dark:text-yellow-300 leading-relaxed">This action will register the misconception and move the breeding record to the "Other Records" section and change the sow's breeding status back to 'available' for future breeding attempts. Only sows with more than 93 days to farrowing can be cancelled.</p>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- Modal Footer -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-xl sm:rounded-b-3xl">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <button id="cancel-cancellation-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:scale-105 font-medium text-xs sm:text-sm">
                            <span class="group-hover:translate-x-1 transition-transform">Cancel</span>
                        </button>
                        <button id="confirm-cancellation-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg sm:rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold text-xs sm:text-sm">
                            <span class="group-hover:translate-x-1 transition-transform">Register Misconception</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Farrowing Modal -->
    <div id="register-farrowing-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-all duration-300">
        <div class="flex items-start sm:items-center justify-center min-h-screen p-1 sm:p-4 overflow-y-auto">
            <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-3xl shadow-2xl w-full max-w-3xl mx-1 sm:mx-4 my-2 sm:my-4 max-h-[98vh] sm:max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300">
                <!-- Modal Header -->
                <div class="relative px-3 sm:px-6 lg:px-8 py-3 sm:py-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="absolute inset-0 bg-gradient-to-r from-green-500/5 via-emerald-500/5 to-green-500/5 rounded-t-xl sm:rounded-t-3xl"></div>
                    <div class="relative flex items-center justify-between">
                        <div class="flex items-center space-x-2 sm:space-x-4">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg sm:rounded-2xl flex items-center justify-center shadow-lg">
                                <i class="fas fa-baby text-white text-sm sm:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-2xl font-bold text-gray-900 dark:text-white">Register Farrowing</h3>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 font-medium">Record farrowing details for sow <span id="farrowing-sow-id" class="font-semibold text-green-600 dark:text-green-400"></span></p>
                            </div>
                        </div>
                        <button id="close-register-farrowing-modal" class="p-1 sm:p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg sm:rounded-xl transition-all duration-200">
                            <i class="fas fa-times text-sm sm:text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Form -->
                <form id="register-farrowing-form" class="px-3 sm:px-6 lg:px-8 py-3 sm:py-6 lg:py-8 space-y-4 sm:space-y-6">
                    <!-- Farrowing Date -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-calendar-alt text-green-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Date of Farrowing
                        </label>
                        <input type="date" id="farrowing-date" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 text-xs sm:text-base" required>
                    </div>
                    
                    <!-- Piglets Information -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                        <div class="space-y-2 sm:space-y-3">
                            <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                                <i class="fas fa-heart text-green-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                                Alive Piglets
                            </label>
                            <input type="number" id="alive-piglets" min="0" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 text-xs sm:text-base" placeholder="0" required>
                        </div>
                        
                        <div class="space-y-2 sm:space-y-3">
                            <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                                <i class="fas fa-heart-broken text-red-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                                Still Births
                            </label>
                            <input type="number" id="still-births" min="0" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 text-xs sm:text-base" placeholder="0" required>
                        </div>
                    </div>
                    
                    <!-- Average Weight -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-weight text-blue-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Average Weight of Piglets (kg)
                        </label>
                        <input type="number" id="avg-weight" min="0" step="0.1" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 text-xs sm:text-base" placeholder="0.0" required>
                    </div>
                    
                    <!-- Health Notes -->
                    <div class="space-y-2 sm:space-y-3">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 sm:mb-2">
                            <i class="fas fa-stethoscope text-purple-500 mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            Health Notes
                        </label>
                        <textarea id="health-notes" rows="3" class="w-full px-2 sm:px-4 py-2 sm:py-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg sm:rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700/50 dark:text-white transition-all duration-300 hover:border-green-300 dark:hover:border-green-500 resize-none text-xs sm:text-base" placeholder="Enter any health observations about the sow or piglets..."></textarea>
                    </div>
                    
                    <!-- Info Box -->
                    <div class="relative bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200/50 dark:border-green-700/50 rounded-lg sm:rounded-2xl p-3 sm:p-6">
                        <div class="absolute inset-0 bg-gradient-to-r from-green-500/5 to-emerald-500/5 rounded-lg sm:rounded-2xl"></div>
                        <div class="relative flex items-start space-x-2 sm:space-x-3">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg sm:rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 mt-0.5 sm:mt-1">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="space-y-1 sm:space-y-2">
                                <p class="text-xs sm:text-sm font-semibold text-green-800 dark:text-green-200">Important Information</p>
                                <p class="text-xs sm:text-sm text-green-700 dark:text-green-300 leading-relaxed">After registration, the sow's status will be updated to "farrowed" and she will need time to recover before being available for breeding again.</p>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- Modal Footer -->
                <div class="px-3 sm:px-6 lg:px-8 py-3 sm:py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-xl sm:rounded-b-3xl">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 lg:space-x-6">
                        <button id="cancel-farrowing-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:scale-105 font-medium text-xs sm:text-sm">
                            <span class="group-hover:translate-x-1 transition-transform">Cancel</span>
                        </button>
                        <button id="confirm-farrowing-btn" class="group w-full sm:w-auto px-3 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg sm:rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold text-xs sm:text-sm">
                            <span class="group-hover:translate-x-1 transition-transform">Register Farrowing</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="md:ml-72 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200/50 dark:border-gray-700/50 py-8">
        <div class="px-6 sm:px-8 lg:px-10">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="relative">
                        <div class="w-10 h-10 bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                            <span class="text-white font-bold text-lg">🐷</span>
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-br from-red-400 via-pink-400 to-purple-500 rounded-xl blur-xl opacity-30"></div>
                    </div>
                    <div class="space-y-1">
                        <p class="text-lg font-bold bg-gradient-to-r from-red-600 via-pink-600 to-purple-600 bg-clip-text text-transparent">PigFarm Pro</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Enterprise Farm Management System</p>
                    </div>
                </div>
                <div class="text-center md:text-right space-y-2">
                    <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">&copy; 2024 PigFarm Pro. All rights reserved.</p>
                    <p class="text-xs text-gray-500 dark:text-gray-500">Version 1.0.0 | Built with ❤️ for Modern Farming</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Dark mode functionality
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }

        // Initialize dark mode
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // Mobile sidebar functionality
        function setupMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        
            if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
                    sidebarOverlay.classList.remove('hidden');
        });
            }
        
            if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                });
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                });
            }
        }

        // Search functionality
        function setupSearch() {
            const searchSows = document.getElementById('search-sows');
            const searchBoars = document.getElementById('search-boars');

            if (searchSows) {
                searchSows.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const sowCards = document.querySelectorAll('#sows-container > div:not(.col-span-full)');
                    
                    sowCards.forEach(card => {
                        const sowTag = card.querySelector('h3')?.textContent.toLowerCase() || '';
                        const sowBreed = card.querySelector('.space-y-2 .text-sm')?.textContent.toLowerCase() || '';
                        
                        if (sowTag.includes(searchTerm) || sowBreed.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }

            if (searchBoars) {
                searchBoars.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const boarCards = document.querySelectorAll('#boars-container > div:not(.col-span-full)');
                    
                    boarCards.forEach(card => {
                        const boarTag = card.querySelector('h3')?.textContent.toLowerCase() || '';
                        const boarBreed = card.querySelector('.space-y-2 .text-sm')?.textContent.toLowerCase() || '';
                        
                        if (boarTag.includes(searchTerm) || boarBreed.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }
        }

        // Breeding management functionality
        let availableSows = [];
        let availableBoars = [];
        let breedingRecords = [];

        // Modal functionality
        function setupModals() {
            // New Breeding Modal
            const newBreedingBtn = document.getElementById('new-breeding-btn');
            const newBreedingModal = document.getElementById('new-breeding-modal');
            const closeNewBreedingBtn = document.getElementById('close-new-breeding-modal');
            const cancelBreedingBtn = document.getElementById('cancel-breeding-btn');

            if (newBreedingBtn && newBreedingModal) {
                newBreedingBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal(newBreedingModal);
                });
                if (closeNewBreedingBtn) closeNewBreedingBtn.addEventListener('click', () => hideModal(newBreedingModal));
                if (cancelBreedingBtn) cancelBreedingBtn.addEventListener('click', () => hideModal(newBreedingModal));
            }

            // Cancel Breeding Modal
            const cancelBreedingModal = document.getElementById('cancel-breeding-modal');
            const closeCancelBreedingBtn = document.getElementById('close-cancel-breeding-modal');
            const cancelCancellationBtn = document.getElementById('cancel-cancellation-btn');

            if (cancelBreedingModal) {
                if (closeCancelBreedingBtn) closeCancelBreedingBtn.addEventListener('click', () => hideModal(cancelBreedingModal));
                if (cancelCancellationBtn) cancelCancellationBtn.addEventListener('click', () => hideModal(cancelBreedingModal));
            }

            // Register Farrowing Modal
            const registerFarrowingModal = document.getElementById('register-farrowing-modal');
            const closeRegisterFarrowingBtn = document.getElementById('close-register-farrowing-modal');
            const cancelFarrowingBtn = document.getElementById('cancel-farrowing-btn');

            if (registerFarrowingModal) {
                if (closeRegisterFarrowingBtn) closeRegisterFarrowingBtn.addEventListener('click', () => hideModal(registerFarrowingModal));
                if (cancelFarrowingBtn) cancelFarrowingBtn.addEventListener('click', () => hideModal(registerFarrowingModal));
            }

            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {
                    hideModal(e.target);
                }
            });
        }

        // Show modal with animation
        function showModal(modal) {
            if (modal) {
                modal.classList.remove('hidden');
                // Force a reflow to ensure the modal is visible before animation
                modal.offsetHeight;
                setTimeout(() => {
                    // Try multiple selectors to find the modal content
                    let modalContent = modal.querySelector('.bg-white\\/95');
                    if (!modalContent) {
                        modalContent = modal.querySelector('.bg-white');
                    }
                    if (!modalContent) {
                        modalContent = modal.querySelector('div[class*="bg-white"]');
                    }
                    if (!modalContent) {
                        // Fallback: get the second div (the modal content)
                        const divs = modal.querySelectorAll('div');
                        modalContent = divs[1]; // The second div should be the modal content
                    }
                    
                    if (modalContent) {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                    }
                }, 10);
            }
        }

        // Hide modal with animation
        function hideModal(modal) {
            if (modal) {
                // Try multiple selectors to find the modal content
                let modalContent = modal.querySelector('.bg-white\\/95');
                if (!modalContent) {
                    modalContent = modal.querySelector('.bg-white');
                }
                if (!modalContent) {
                    modalContent = modal.querySelector('div[class*="bg-white"]');
                }
                if (!modalContent) {
                    // Fallback: get the second div (the modal content)
                    const divs = modal.querySelectorAll('div');
                    modalContent = divs[1]; // The second div should be the modal content
                }
                
                if (modalContent) {
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                }
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupMobileMenu();
            setupSearch();
            setupModals();
            
            // Initialize user dropdown
        const userDropdownBtn = document.getElementById('user-dropdown-btn');
        const userDropdown = document.getElementById('user-dropdown');
        
            if (userDropdownBtn && userDropdown) {
        userDropdownBtn.addEventListener('click', () => {
            userDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!userDropdownBtn.contains(e.target)) {
                userDropdown.classList.add('hidden');
            }
        });
            }

        // Logout functionality
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
            window.location.href = '/logout';
        });
            }

            // Load data
            loadAvailableSows();
            loadAvailableBoars();
            loadBreedingRecords();
            loadFailedConceptions();
            loadCompletedFarrowings();
        });

        // Load available sows
        async function loadAvailableSows() {
            try {
                const response = await fetch('/api/breeding/available-sows');
                const data = await response.json();
                if (data.success) {
                    availableSows = data.sows || [];
                    const countElement = document.getElementById('available-sows-count');
                    if (countElement) {
                        countElement.textContent = availableSows.length;
                    }
                    
                    const sowSelect = document.getElementById('sow-select');
                    if (sowSelect) {
                    sowSelect.innerHTML = '<option value="">Select a sow...</option>';
                    availableSows.forEach(sow => {
                        const option = document.createElement('option');
                        option.value = sow.id;
                        option.textContent = `${sow.tag_id} - ${sow.breed}`;
                        sowSelect.appendChild(option);
                    });
                    }
                    
                    // Display sows in cards
                    displaySows(availableSows);
                } else {
                    console.error('Failed to load sows:', data.error);
                    displaySowsError();
                }
            } catch (error) {
                console.error('Error loading available sows:', error);
                displaySowsError();
            }
        }

        // Load available boars
        async function loadAvailableBoars() {
            try {
                const response = await fetch('/api/breeding/available-boars');
                const data = await response.json();
                if (data.success) {
                    availableBoars = data.boars || [];
                    const countElement = document.getElementById('available-boars-count');
                    if (countElement) {
                        countElement.textContent = availableBoars.length;
                    }
                    
                    const boarSelect = document.getElementById('boar-select');
                    if (boarSelect) {
                    boarSelect.innerHTML = '<option value="">Select a boar...</option>';
                    availableBoars.forEach(boar => {
                        const option = document.createElement('option');
                        option.value = boar.id;
                        option.textContent = `${boar.tag_id} - ${boar.breed}`;
                        boarSelect.appendChild(option);
                    });
                    }
                    
                    // Display boars in cards
                    displayBoars(availableBoars);
                } else {
                    console.error('Failed to load boars:', data.error);
                    displayBoarsError();
                }
            } catch (error) {
                console.error('Error loading available boars:', error);
                displayBoarsError();
            }
        }

        // Load breeding records for statistics only
        async function loadBreedingRecords() {
            try {
                const response = await fetch('/api/breeding/list');
                const data = await response.json();
                if (data.success) {
                    breedingRecords = data.records || [];
                    
                    // Update the counts in the statistics cards
                    const activeBreedingElement = document.getElementById('active-breeding-count');
                    const pregnantSowsElement = document.getElementById('pregnant-sows-count');
                    
                    if (activeBreedingElement) {
                        activeBreedingElement.textContent = breedingRecords.filter(r => r.breeding_status === 'served').length;
                    }
                    if (pregnantSowsElement) {
                        pregnantSowsElement.textContent = breedingRecords.filter(r => r.breeding_status === 'pregnant').length;
                    }
                }
            } catch (error) {
                console.error('Error loading breeding records:', error);
            }
        }

        // Refresh all data
        function refreshAllData() {
            loadAvailableSows();
            loadAvailableBoars();
            loadBreedingRecords();
            loadFailedConceptions();
            loadCompletedFarrowings();
        }

        // Display sows in cards
        function displaySows(sows) {
            const container = document.getElementById('sows-container');
            const mobileContainer = container.querySelector('.block.lg\\:hidden');
            const desktopContainer = container.querySelector('.hidden.lg\\:block');
            
            if (sows.length === 0) {
                mobileContainer.innerHTML = `
                    <div class="col-span-full flex items-center justify-center py-12">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-female text-gray-400 text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Available Sows</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">No sows are currently available for breeding.</p>
                            </div>
                    </div>
                `;
                desktopContainer.innerHTML = `
                    <div class="flex items-center justify-center py-12">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-female text-gray-400 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Available Sows</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">No sows are currently available for breeding.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Mobile layout (cards)
            mobileContainer.innerHTML = sows.map((sow, index) => `
                <div class="group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative animate-slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-500/5 to-pink-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <div class="relative z-10">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-pink-100 to-pink-200 dark:from-pink-900/30 dark:to-pink-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-female text-pink-600 dark:text-pink-400 text-sm"></i>
                            </div>
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                AVAILABLE
                            </span>
                            </div>
                        
                        <!-- Sow Info -->
                        <div class="mb-4">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">${sow.tag_id || 'Untagged Sow'}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">ID: ${sow.id} • ${sow.gender?.toUpperCase() || 'Unknown'}</p>
                        </div>
                        
                        <!-- Details -->
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Breed:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${sow.breed || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Age:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${sow.age_days ? Math.round(sow.age_days / 30) + ' months' : 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Health:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${sow.health_status || 'Healthy'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Last Breeding:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${sow.last_breeding_date ? new Date(sow.last_breeding_date).toLocaleDateString() : 'Never'}</span>
                            </div>
                        </div>
                        
                        <!-- Action Button -->
                        <button onclick="selectSowForBreeding(${sow.id})" class="w-full px-4 py-2 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white text-sm font-semibold rounded-lg transition-all duration-200 hover:shadow-lg hover:scale-105">
                            <i class="fas fa-heart mr-2"></i>
                            Select for Breeding
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Desktop layout (list)
            desktopContainer.innerHTML = sows.map((sow, index) => `
                <div class="group bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-all duration-200 animate-slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="px-6 py-4">
                        <div class="flex items-center justify-between">
                            <!-- Left Section: Main Info -->
                            <div class="flex items-center space-x-6 flex-1">
                                <!-- Status Icon -->
                                <div class="w-12 h-12 bg-gradient-to-br from-pink-100 to-pink-200 dark:from-pink-900/30 dark:to-pink-800/30 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-female text-pink-600 dark:text-pink-400 text-lg"></i>
                                </div>
                                
                                <!-- Sow Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-4 mb-2">
                                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">${sow.tag_id || 'Untagged Sow'}</h3>
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                            <div class="w-2 h-2 rounded-full mr-2 bg-green-500 animate-pulse"></div>
                            AVAILABLE
                        </span>
                                    </div>
                                    
                                    <!-- Sow Details -->
                                    <div class="flex items-center space-x-8 text-sm text-gray-600 dark:text-gray-400">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-tag text-pink-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">ID: ${sow.id}</span>
                                            <span class="text-gray-500">${sow.gender?.toUpperCase() || 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-dna text-purple-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${sow.breed || 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-calendar text-blue-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${sow.age_days ? Math.round(sow.age_days / 30) + ' months' : 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-heartbeat text-green-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${sow.health_status || 'Healthy'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-heart text-red-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${sow.last_breeding_date ? new Date(sow.last_breeding_date).toLocaleDateString() : 'Never'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Section: Action -->
                            <div class="flex items-center space-x-4">
                                <button onclick="selectSowForBreeding(${sow.id})" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white text-sm font-semibold rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <i class="fas fa-heart mr-2 text-sm"></i>
                            Select for Breeding
                        </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display sows error
        function displaySowsError() {
            const container = document.getElementById('sows-container');
            if (container) {
            container.innerHTML = `
                    <div class="col-span-full flex items-center justify-center py-12">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/20 dark:to-red-800/20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Error Loading Sows</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Failed to load sow data. Please try again.</p>
                            <button onclick="loadAvailableSows()" class="inline-flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Try Again
                            </button>
                        </div>
                    </div>
            `;
            }
        }

        // Display boars in cards
        function displayBoars(boars) {
            const container = document.getElementById('boars-container');
            const mobileContainer = container.querySelector('.block.lg\\:hidden');
            const desktopContainer = container.querySelector('.hidden.lg\\:block');
            
            if (boars.length === 0) {
                mobileContainer.innerHTML = `
                    <div class="col-span-full flex items-center justify-center py-12">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-male text-gray-400 text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Available Boars</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">No boars are currently available for breeding.</p>
                            </div>
                    </div>
                `;
                desktopContainer.innerHTML = `
                    <div class="flex items-center justify-center py-12">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-male text-gray-400 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Available Boars</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">No boars are currently available for breeding.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Mobile layout (cards)
            mobileContainer.innerHTML = boars.map((boar, index) => `
                <div class="group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden relative animate-slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-blue-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <div class="relative z-10">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-male text-blue-600 dark:text-blue-400 text-sm"></i>
                            </div>
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                AVAILABLE
                            </span>
                            </div>
                        
                        <!-- Boar Info -->
                        <div class="mb-4">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">${boar.tag_id || 'Untagged Boar'}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">ID: ${boar.id} • ${boar.gender?.toUpperCase() || 'Unknown'}</p>
                        </div>
                        
                        <!-- Details -->
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Breed:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${boar.breed || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Age:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${boar.age_days ? Math.round(boar.age_days / 30) + ' months' : 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Health:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${boar.health_status || 'Healthy'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500 dark:text-gray-400">Last Breeding:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${boar.last_breeding_date ? new Date(boar.last_breeding_date).toLocaleDateString() : 'Never'}</span>
                            </div>
                        </div>
                        
                        <!-- Action Button -->
                        <button onclick="selectBoarForBreeding(${boar.id})" class="w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm font-semibold rounded-lg transition-all duration-200 hover:shadow-lg hover:scale-105">
                            <i class="fas fa-heart mr-2"></i>
                            Select for Breeding
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Desktop layout (list)
            desktopContainer.innerHTML = boars.map((boar, index) => `
                <div class="group bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-all duration-200 animate-slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="px-6 py-4">
                        <div class="flex items-center justify-between">
                            <!-- Left Section: Main Info -->
                            <div class="flex items-center space-x-6 flex-1">
                                <!-- Status Icon -->
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-male text-blue-600 dark:text-blue-400 text-lg"></i>
                                </div>
                                
                                <!-- Boar Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-4 mb-2">
                                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">${boar.tag_id || 'Untagged Boar'}</h3>
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                            <div class="w-2 h-2 rounded-full mr-2 bg-blue-500 animate-pulse"></div>
                            AVAILABLE
                        </span>
                                    </div>
                                    
                                    <!-- Boar Details -->
                                    <div class="flex items-center space-x-8 text-sm text-gray-600 dark:text-gray-400">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-tag text-blue-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">ID: ${boar.id}</span>
                                            <span class="text-gray-500">${boar.gender?.toUpperCase() || 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-dna text-purple-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${boar.breed || 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-calendar text-blue-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${boar.age_days ? Math.round(boar.age_days / 30) + ' months' : 'Unknown'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-heartbeat text-green-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${boar.health_status || 'Healthy'}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-heart text-red-500 text-sm"></i>
                                            <span class="font-semibold text-gray-900 dark:text-white">${boar.last_breeding_date ? new Date(boar.last_breeding_date).toLocaleDateString() : 'Never'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Section: Action -->
                            <div class="flex items-center space-x-4">
                                <button onclick="selectBoarForBreeding(${boar.id})" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm font-semibold rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <i class="fas fa-heart mr-2 text-sm"></i>
                            Select for Breeding
                        </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display boars error
        function displayBoarsError() {
            const container = document.getElementById('boars-container');
            if (container) {
            container.innerHTML = `
                    <div class="col-span-full flex items-center justify-center py-12">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/20 dark:to-red-800/20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Error Loading Boars</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Failed to load boar data. Please try again.</p>
                            <button onclick="loadAvailableBoars()" class="inline-flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Try Again
                            </button>
                        </div>
                    </div>
            `;
            }
        }

        // Search functionality for sows
        function setupSowSearch() {
            const searchInput = document.getElementById('search-sows');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const sowRows = document.querySelectorAll('#sows-container tr');
                    
                    sowRows.forEach(row => {
                        // Skip the loading/error/empty state rows
                        if (row.querySelector('td[colspan]')) {
                            return;
                        }
                        
                        const sowTag = row.querySelector('td:first-child .text-sm.font-semibold')?.textContent.toLowerCase() || '';
                        const sowBreed = row.querySelector('td:nth-child(2) .text-sm.font-medium')?.textContent.toLowerCase() || '';
                        const sowAge = row.querySelector('td:nth-child(2) .text-sm.text-gray-500')?.textContent.toLowerCase() || '';
                        
                        if (sowTag.includes(searchTerm) || 
                            sowBreed.includes(searchTerm) || 
                            sowAge.includes(searchTerm)) {
                            row.style.display = 'table-row';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }
        }

        // Search functionality for boars
        function setupBoarSearch() {
            const searchInput = document.getElementById('search-boars');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const boarRows = document.querySelectorAll('#boars-container tr');
                    
                    boarRows.forEach(row => {
                        // Skip the loading/error/empty state rows
                        if (row.querySelector('td[colspan]')) {
                            return;
                        }
                        
                        const boarTag = row.querySelector('td:first-child .text-sm.font-semibold')?.textContent.toLowerCase() || '';
                        const boarBreed = row.querySelector('td:nth-child(2) .text-sm.font-medium')?.textContent.toLowerCase() || '';
                        const boarAge = row.querySelector('td:nth-child(2) .text-sm.text-gray-500')?.textContent.toLowerCase() || '';
                        
                        if (boarTag.includes(searchTerm) || 
                            boarBreed.includes(searchTerm) || 
                            boarAge.includes(searchTerm)) {
                            row.style.display = 'table-row';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }
        }

        // Select sow for breeding
        function selectSowForBreeding(sowId) {
            const sow = availableSows.find(s => s.id === sowId);
            if (sow) {
                document.getElementById('sow-select').value = sowId;
                // Open the new breeding modal using the proper showModal function
                const modal = document.getElementById('new-breeding-modal');
                showModal(modal);
            }
        }

        // Select boar for breeding
        function selectBoarForBreeding(boarId) {
            const boar = availableBoars.find(b => b.id === boarId);
            if (boar) {
                document.getElementById('boar-select').value = boarId;
                // Open the new breeding modal using the proper showModal function
                const modal = document.getElementById('new-breeding-modal');
                showModal(modal);
            }
        }

        // Load failed conceptions for statistics only
        async function loadFailedConceptions() {
            try {
                const response = await fetch('/api/breeding/failed-conceptions');
                const data = await response.json();
                if (data.success) {
                    // Update the count in the statistics card
                    document.getElementById('failed-conceptions-count').textContent = data.records.length;
                }
            } catch (error) {
                console.error('Error loading failed conceptions:', error);
            }
        }

        // Load completed farrowings for statistics only
        async function loadCompletedFarrowings() {
            try {
                const response = await fetch('/api/breeding/completed-farrowings');
                const data = await response.json();
                if (data.success) {
                    // Update the count in the statistics card
                    document.getElementById('completed-farrowings-count').textContent = data.records.length;
                }
            } catch (error) {
                console.error('Error loading completed farrowings:', error);
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'served': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
                case 'pregnant': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                case 'cancelled': return 'bg-red-100 text-red-800 dark:bg-gray-900 dark:text-red-200';
                case 'completed': return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';
                case 'farrowed': return 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200';
                default: return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';
            }
        }
        


        // Additional modal functionality for form handling
        const saveBreedingBtn = document.getElementById('save-breeding-btn');

        // Cancel breeding modal elements
        const cancelBreedingModal = document.getElementById('cancel-breeding-modal');
        const cancelCancellationBtn = document.getElementById('cancel-cancellation-btn');
        const confirmCancellationBtn = document.getElementById('confirm-cancellation-btn');
        let currentBreedingId = null;

        // Register farrowing modal elements
        const registerFarrowingModal = document.getElementById('register-farrowing-modal');
        const cancelFarrowingBtn = document.getElementById('cancel-farrowing-btn');
        const confirmFarrowingBtn = document.getElementById('confirm-farrowing-btn');
        let currentFarrowingData = null;

        // Event listeners are handled in setupModals() function

        // Show failure to conceive modal
        function showCancelBreedingModal(breedingId) {
            currentBreedingId = breedingId;
            document.getElementById('cancellation-reason').value = '';
            const modal = document.getElementById('cancel-breeding-modal');
            modal.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                modal.querySelector('.bg-white\\/95').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.bg-white\\/95').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // Show register farrowing modal
        function showRegisterFarrowingModal(breedingId, sowTagId, boarTagId, matingDate) {
            currentFarrowingData = {
                breedingId: breedingId,
                sowTagId: sowTagId,
                boarTagId: boarTagId,
                matingDate: matingDate
            };
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('farrowing-date').value = today;
            
            // Clear other fields
            document.getElementById('alive-piglets').value = '';
            document.getElementById('still-births').value = '';
            document.getElementById('avg-weight').value = '';
            document.getElementById('health-notes').value = '';
            
            // Update sow ID display
            document.getElementById('farrowing-sow-id').textContent = sowTagId;
            
            const modal = document.getElementById('register-farrowing-modal');
            modal.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                modal.querySelector('.bg-white\\/95').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.bg-white\\/95').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // Cancel cancellation modal
        cancelCancellationBtn.addEventListener('click', () => {
            const cancelBreedingModal = document.getElementById('cancel-breeding-modal');
            hideModal(cancelBreedingModal);
        });

        // Cancel farrowing modal
        cancelFarrowingBtn.addEventListener('click', () => {
            const registerFarrowingModal = document.getElementById('register-farrowing-modal');
            hideModal(registerFarrowingModal);
        });

        // Confirm cancellation
        confirmCancellationBtn.addEventListener('click', async () => {
            const reason = document.getElementById('cancellation-reason').value.trim();
            
            if (!reason) {
                alert('Please provide details about why the sow failed to conceive before registering the misconception');
                return;
            }

            if (currentBreedingId) {
                await cancelBreeding(currentBreedingId, reason);
                const cancelBreedingModal = document.getElementById('cancel-breeding-modal');
                hideModal(cancelBreedingModal);
            }
        });

        // Confirm farrowing registration
        confirmFarrowingBtn.addEventListener('click', async () => {
            const farrowingDate = document.getElementById('farrowing-date').value;
            const alivePiglets = document.getElementById('alive-piglets').value;
            const stillBirths = document.getElementById('still-births').value;
            const avgWeight = document.getElementById('avg-weight').value;
            const healthNotes = document.getElementById('health-notes').value;

            if (!farrowingDate || !alivePiglets || !stillBirths || !avgWeight) {
                alert('Please fill in all required fields');
                return;
            }

            if (currentFarrowingData) {
                await registerFarrowing(currentFarrowingData.breedingId, {
                    farrowing_date: farrowingDate,
                    alive_piglets: parseInt(alivePiglets),
                    still_births: parseInt(stillBirths),
                    avg_weight: parseFloat(avgWeight),
                    health_notes: healthNotes
                });
                registerFarrowingModal.classList.add('hidden');
                currentFarrowingData = null;
            }
        });

        // Register farrowing function
        async function registerFarrowing(breedingId, farrowingData) {
            try {
                const response = await fetch(`/api/breeding/register-farrowing/${breedingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(farrowingData)
                });

                const data = await response.json();
                if (data.success) {
                    loadBreedingRecords();
                    loadAvailableSows();
                    loadCompletedFarrowings(); // Reload completed farrowings to show the new record
                    alert('Farrowing registered successfully! Sow status updated to "farrowed" and breeding record completed.');
                    // Refresh the page to show updated data
                    window.location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error registering farrowing:', error);
                alert('Error registering farrowing');
            }
        }

        saveBreedingBtn.addEventListener('click', async () => {
            const sowId = document.getElementById('sow-select').value;
            const boarId = document.getElementById('boar-select').value;
            const matingDate = document.getElementById('mating-date').value;
            const notes = document.getElementById('breeding-notes').value;

            if (!sowId || !boarId || !matingDate) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const response = await fetch('/api/breeding/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sow_id: sowId,
                        boar_id: boarId,
                        mating_date: matingDate,
                        notes: notes
                    })
                });

                const data = await response.json();
                if (data.success) {
                    const newBreedingModal = document.getElementById('new-breeding-modal');
                    hideModal(newBreedingModal);
                    loadBreedingRecords();
                    loadAvailableSows();
                    alert('Breeding record created successfully!');
                    // Refresh the page to show updated data
                    window.location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error creating breeding record:', error);
                alert('Error creating breeding record');
            }
        });

        // Record failure to conceive function
        async function cancelBreeding(breedingId, reason) {
            try {
                const response = await fetch(`/api/breeding/cancel/${breedingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        reason: reason
                    })
                });

                const data = await response.json();
                if (data.success) {
                    loadBreedingRecords();
                    loadAvailableSows();
                    loadFailedConceptions(); // Reload failed conceptions to show the moved record
                    alert('Misconception registered successfully! Record moved to Other Records and sow status updated to available.');
                    // Refresh the page to show updated data
                    window.location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error recording failure to conceive:', error);
                alert('Error recording failure to conceive');
            }
        }

        // Animate progress bars based on counts
        function animateProgressBars() {
            const cards = document.querySelectorAll('.group');
            cards.forEach(card => {
                const countElement = card.querySelector('[id$="-count"]');
                const progressBar = card.querySelector('.bg-gradient-to-r');
                
                if (countElement && progressBar) {
                    const count = parseInt(countElement.textContent) || 0;
                    const maxCount = Math.max(count, 10); // Set a reasonable max for animation
                    const percentage = Math.min((count / maxCount) * 100, 100);
                    
                    // Animate the progress bar
                    setTimeout(() => {
                        progressBar.style.width = `${percentage}%`;
                    }, 500);
                }
            });
        }

        // Add loading states and animations
        function showLoadingState() {
            const cards = document.querySelectorAll('[id$="-count"]');
            cards.forEach(card => {
                card.textContent = '...';
                card.classList.add('animate-pulse');
            });
        }

        function hideLoadingState() {
            const cards = document.querySelectorAll('[id$="-count"]');
            cards.forEach(card => {
                card.classList.remove('animate-pulse');
            });
        }

        // Enhanced refresh function with loading states
        async function refreshAllData() {
            showLoadingState();
            
            try {
                await Promise.all([
                    loadAvailableSows(),
                    loadAvailableBoars(),
                    loadBreedingRecords(),
                    loadFailedConceptions(),
                    loadCompletedFarrowings(),
                ]);
                
                // Animate progress bars after data loads
                setTimeout(() => {
                    animateProgressBars();
                }, 100);
                
            } catch (error) {
                console.error('Error refreshing data:', error);
            } finally {
                hideLoadingState();
            }
        }

        // Add smooth scroll behavior for better UX
        function smoothScrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + R to refresh data
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshAllData();
            }
            
            // Ctrl/Cmd + N to open new breeding modal
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showNewBreedingModal();
            }
        });

        // Add intersection observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fadeInUp');
                }
            });
        }, observerOptions);

        // Observe all cards for animation
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.group');
            cards.forEach(card => {
                observer.observe(card);
            });
        });

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadAvailableSows();
            loadAvailableBoars();
            loadBreedingRecords();
            loadFailedConceptions();
            loadCompletedFarrowings();
            
            // Setup search functionality
            setupSowSearch();
            setupBoarSearch();
            
            // Animate progress bars after initial load
            setTimeout(() => {
                animateProgressBars();
            }, 1000);
            
            // Mobile menu functionality
            setupMobileMenu();
        });

        // Mobile menu functionality
        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const closeSidebarBtn = document.getElementById('close-sidebar');
            const mobileOverlay = document.getElementById('mobile-overlay');

            // Open sidebar
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.remove('-translate-x-full');
                    mobileOverlay.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');
                });
            }

            // Close sidebar
            function closeSidebar() {
                sidebar.classList.add('-translate-x-full');
                mobileOverlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }

            if (closeSidebarBtn) {
                closeSidebarBtn.addEventListener('click', closeSidebar);
            }

            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', closeSidebar);
            }

            // Close sidebar on window resize if it's desktop
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768) {
                    closeSidebar();
                }
            });

            // Close sidebar when clicking on sidebar links
            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) {
                        closeSidebar();
                    }
                });
            });
        }

        // Refresh all data
        function refreshAllData() {
            loadAvailableSows();
            loadAvailableBoars();
            loadBreedingRecords();
            loadFailedConceptions();
            loadCompletedFarrowings();
        }



        // View upcoming activities for a litter
        async function viewUpcomingActivities(litterId) {
            try {
                // Get litter details to find the farrowing record ID
                const response = await fetch(`/api/litter/${litterId}/activities`);
                const data = await response.json();
                
                if (data.success) {
                    showUpcomingActivitiesModal(data.activities, litterId);
                } else {
                    alert('Error loading activities: ' + data.message);
                }
            } catch (error) {
                console.error('Error loading activities:', error);
                alert('Error loading activities. Please try again.');
            }
        }

        // Mark litter as weaned
        async function markLitterWeaned(litterId) {
            try {
                // First check if all activities are completed
                const activitiesResponse = await fetch(`/api/litter/${litterId}/activities`);
                const activitiesData = await activitiesResponse.json();
                
                if (!activitiesData.success) {
                    alert('Error loading activities: ' + activitiesData.message);
                    return;
                }
                
                const activities = activitiesData.activities;
                const incompleteActivities = activities.filter(activity => !activity.completed);
                
                if (incompleteActivities.length > 0) {
                    showIncompleteActivitiesPopup(incompleteActivities, litterId);
                    return;
                }
                
                // All activities completed, proceed with weaning
                if (confirm(`All farrowing activities are completed. Are you sure you want to mark litter ${litterId} as weaned?`)) {
                    const response = await fetch(`/api/litter/${litterId}/wean`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert('Litter marked as weaned successfully!');
                                    // Litter functions removed
                    } else {
                        // Check if it's an incomplete activities error
                        if (data.message.includes('Cannot mark litter as weaned until all farrowing activities are completed')) {
                            // Show the simplified incomplete activities popup
                            showSimplifiedIncompletePopup(litterId);
                        } else {
                            alert('Error: ' + data.message);
                        }
                    }
                }
            } catch (error) {
                console.error('Error marking litter as weaned:', error);
                alert('Error marking litter as weaned. Please try again.');
            }
        }


        // Show upcoming activities modal
        function showUpcomingActivitiesModal(activities, litterId) {
            const activitiesList = activities.map(activity => {
                const dueDate = new Date(activity.due_date);
                const statusClass = activity.completed ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200' :
                                  activity.status_category === 'Overdue' ? 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200' :
                                  activity.status_category === 'Due Today' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200' :
                                  'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200';
                
                return `
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-gray-900 dark:text-white">Day ${activity.due_day}: ${activity.activity_name}</h4>
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                                ${activity.status_category}
                            </span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                            <p><strong>Due Date:</strong> ${dueDate.toLocaleDateString()}</p>
                            <p><strong>Description:</strong> ${activity.description || 'No description available'}</p>
                        </div>
                        ${!activity.completed ? `
                            <div class="space-y-3">
                                ${activity.activity_name === 'Weaning' ? `
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Weaning Weight (kg)</label>
                                            <input type="number" step="0.01" min="0" class="weaning-weight w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white" placeholder="0.00">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Weaning Date & Time</label>
                                            <input type="datetime-local" class="weaning-date w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                        </div>
                                    </div>
                                ` : ''}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notes</label>
                                    <textarea class="activity-notes w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white" rows="2" placeholder="Enter completion notes..."></textarea>
                                </div>
                                <button onclick="completeActivity('${activity.id}', '${activity.activity_name}', this)" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    Mark as Completed
                                </button>
                            </div>
                        ` : `
                            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg p-3">
                                <p class="text-sm text-green-800 dark:text-green-200">
                                    <strong>Completed on:</strong> ${new Date(activity.completed_at).toLocaleString()}
                                </p>
                                ${activity.notes ? `<p class="text-sm text-green-800 dark:text-green-200 mt-1"><strong>Notes:</strong> ${activity.notes}</p>` : ''}
                                ${activity.weaning_weight ? `<p class="text-sm text-green-800 dark:text-green-200 mt-1"><strong>Weaning Weight:</strong> ${activity.weaning_weight} kg</p>` : ''}
                                ${activity.weaning_date ? `<p class="text-sm text-green-800 dark:text-green-200 mt-1"><strong>Weaning Date:</strong> ${new Date(activity.weaning_date).toLocaleString()}</p>` : ''}
                            </div>
                        `}
                    </div>
                `;
            }).join('');

            // Calculate completion summary
            const totalActivities = activities.length;
            const completedActivities = activities.filter(activity => activity.completed).length;
            const incompleteActivities = totalActivities - completedActivities;
            
            const modalHTML = `
                <div id="upcoming-activities-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center">
                    <div class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-3xl shadow-2xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto border border-white/20 dark:border-gray-700/50 transform scale-95 opacity-0 transition-all duration-300">
                        <!-- Modal Header -->
                        <div class="relative px-8 py-6 border-b border-gray-200/50 dark:border-gray-700/50">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-blue-500/5 rounded-t-3xl"></div>
                            <div class="relative flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Farrowing Activities</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Litter <span class="font-semibold text-blue-600 dark:text-blue-400">${litterId}</span> • Monitor and complete activities</p>
                                    </div>
                                </div>
                                <button onclick="closeUpcomingActivitiesModal()" class="group p-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-all duration-300 bg-white/80 dark:bg-gray-700/80 rounded-2xl border border-gray-200/50 dark:border-gray-600/50 hover:bg-white dark:hover:bg-gray-700 hover:shadow-lg hover:scale-105">
                                    <svg class="w-6 h-6 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Completion Summary -->
                            <div class="relative mt-6 p-6 rounded-2xl ${incompleteActivities === 0 ? 'bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200/50 dark:border-green-700/50' : 'bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border border-yellow-200/50 dark:border-yellow-700/50'}">
                                <div class="absolute inset-0 ${incompleteActivities === 0 ? 'bg-gradient-to-r from-green-500/5 to-emerald-500/5' : 'bg-gradient-to-r from-yellow-500/5 to-orange-500/5'} rounded-2xl"></div>
                                <div class="relative flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 ${incompleteActivities === 0 ? 'bg-gradient-to-br from-green-500 to-emerald-600' : 'bg-gradient-to-br from-yellow-500 to-orange-600'} rounded-xl flex items-center justify-center shadow-lg">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${incompleteActivities === 0 ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z'}"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <span class="text-lg font-bold ${incompleteActivities === 0 ? 'text-green-800 dark:text-green-200' : 'text-yellow-800 dark:text-yellow-200'}">
                                                ${incompleteActivities === 0 ? '✅ All Activities Completed' : '⚠️ Activities Pending'}
                                            </span>
                                            <p class="text-sm ${incompleteActivities === 0 ? 'text-green-700 dark:text-green-300' : 'text-yellow-700 dark:text-yellow-300'} mt-1">
                                                ${completedActivities}/${totalActivities} activities completed
                                            </p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold ${incompleteActivities === 0 ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}">
                                            ${incompleteActivities === 0 ? '100%' : Math.round((completedActivities/totalActivities) * 100) + '%'}
                                        </div>
                                        <div class="text-sm ${incompleteActivities === 0 ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'} font-medium">
                                            ${incompleteActivities === 0 ? 'Ready for weaning' : 'Completion rate'}
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    ${incompleteActivities === 0 ? 
                                        '<p class="text-sm text-green-700 dark:text-green-300 font-medium">🎉 This litter can now be marked as weaned!</p>' :
                                        '<p class="text-sm text-yellow-700 dark:text-yellow-300 font-medium">Complete all activities before marking this litter as weaned.</p>'
                                    }
                                </div>
                            </div>
                        </div>
                        <!-- Modal Content -->
                        <div class="px-8 py-6">
                            <div class="space-y-4">
                                ${activitiesList}
                            </div>
                        </div>
                        
                        <!-- Modal Footer -->
                        <div class="px-8 py-6 border-t border-gray-200/50 dark:border-gray-700/50 flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 ${incompleteActivities === 0 ? 'bg-green-500' : 'bg-yellow-500'} rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-bold">${incompleteActivities === 0 ? '🎉' : '⏳'}</span>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300">
                                        ${incompleteActivities === 0 ? 
                                            'Ready for weaning' : 
                                            `${incompleteActivities} activity${incompleteActivities > 1 ? 's' : ''} remaining`
                                        }
                                    </div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        ${incompleteActivities === 0 ? 'All farrowing activities completed successfully' : 'Complete pending activities to proceed with weaning'}
                                    </div>
                                </div>
                            </div>
                            <button onclick="closeUpcomingActivitiesModal()" class="group px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                                <span class="group-hover:translate-x-1 transition-transform">Close Activities</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            // Show modal with animation
            setTimeout(() => {
                showModalWithAnimation('upcoming-activities-modal');
            }, 10);
        }

        // Close upcoming activities modal
        function closeUpcomingActivitiesModal() {
            const modal = document.getElementById('upcoming-activities-modal');
            if (modal) {
                // Trigger animation
                const modalContent = modal.querySelector('.bg-white\\/95');
                if (modalContent) {
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        modal.remove();
                    }, 300);
                } else {
                    modal.remove();
                }
            }
        }

        // Show modal with animation
        function showModalWithAnimation(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                const modalContent = modal.querySelector('.bg-white\\/95');
                if (modalContent) {
                    setTimeout(() => {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                }
            }
        }

        // Show incomplete activities popup
        function showIncompleteActivitiesPopup(incompleteActivities, litterId) {
            const activitiesList = incompleteActivities.map(activity => {
                const dueDate = new Date(activity.due_date);
                const isOverdue = dueDate < new Date();
                const isDueToday = dueDate.toDateString() === new Date().toDateString();
                
                let statusClass = 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200';
                let statusText = 'Upcoming';
                
                if (isOverdue) {
                    statusClass = 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200';
                    statusText = 'Overdue';
                } else if (isDueToday) {
                    statusClass = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200';
                    statusText = 'Due Today';
                }
                
                return `
                    <div class="group bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-gray-200/50 dark:border-gray-600/50 rounded-2xl p-4 hover:bg-white dark:hover:bg-gray-800 hover:shadow-lg hover:scale-105 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900 dark:text-white text-lg">Day ${activity.due_day}: ${activity.activity_name}</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Due: <span class="font-medium">${dueDate.toLocaleDateString()}</span></p>
                                </div>
                            </div>
                            <span class="px-4 py-2 text-sm font-semibold rounded-full ${statusClass} shadow-lg">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            const modalHTML = `
                <div id="incomplete-activities-popup" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Cannot Mark Litter as Weaned</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Litter ${litterId} has incomplete farrowing activities</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="px-6 py-4">
                            <div class="mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    <p class="text-sm font-medium text-red-800 dark:text-red-200">
                                        <strong>Weaning Blocked</strong> - Complete all activities first
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Incomplete Activities (${incompleteActivities.length}):</h4>
                                <div class="space-y-2 max-h-64 overflow-y-auto">
                                    ${activitiesList}
                                </div>
                            </div>
                            
                            <div class="relative bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200/50 dark:border-blue-700/50 rounded-2xl p-6">
                                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 rounded-2xl"></div>
                                <div class="relative flex items-start space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 mt-1">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="space-y-2">
                                        <p class="text-lg font-bold text-blue-800 dark:text-blue-200">
                                            Next Steps
                                        </p>
                                        <p class="text-sm text-blue-700 dark:text-blue-300 leading-relaxed">
                                            Complete all pending activities before attempting to mark this litter as weaned. You can view and complete activities by clicking "Upcoming Activities" for this litter.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Modal Footer -->
                        <div class="px-8 py-6 border-t border-gray-200/50 dark:border-gray-700/50 flex justify-between items-center">
                            <button onclick="viewUpcomingActivities('${litterId}')" class="group px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="group-hover:translate-x-1 transition-transform">View & Complete Activities</span>
                            </button>
                            <button onclick="closeIncompleteActivitiesPopup()" class="group px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 font-semibold">
                                <span class="group-hover:translate-x-1 transition-transform">Close</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            // Show modal with animation
            setTimeout(() => {
                showModalWithAnimation('incomplete-activities-popup');
            }, 10);
        }

        // Close incomplete activities popup
        function closeIncompleteActivitiesPopup() {
            const popup = document.getElementById('incomplete-activities-popup');
            if (popup) {
                // Trigger animation
                const popupContent = popup.querySelector('.bg-white\\/95');
                if (popupContent) {
                    popupContent.classList.remove('scale-100', 'opacity-100');
                    popupContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        popup.remove();
                    }, 300);
                } else {
                    popup.remove();
                }
            }
        }

        // Show simplified incomplete activities popup (when we don't have full activity details)
        function showSimplifiedIncompletePopup(litterId) {
            const modalHTML = `
                <div id="incomplete-activities-popup" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Cannot Mark Litter as Weaned</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Litter ${litterId} has incomplete farrowing activities</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="px-6 py-4">
                            <div class="mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    <p class="text-sm font-medium text-red-800 dark:text-red-200">
                                        <strong>Weaning Blocked</strong> - Complete all activities first
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    The system detected that not all farrowing activities have been completed for this litter. 
                                    You must complete all required activities before marking the litter as weaned.
                                </p>
                            </div>
                            
                            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <p class="text-sm text-blue-800 dark:text-blue-200">
                                        <strong>Next Steps:</strong> Click "View & Complete Activities" to see what needs to be done and complete the pending activities.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <button onclick="viewUpcomingActivities('${litterId}')" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center space-x-2">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                <span>View & Complete Activities</span>
                            </button>
                            <button onclick="closeIncompleteActivitiesPopup()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Complete an activity
        async function completeActivity(activityId, activityName, buttonElement) {
            const notes = buttonElement.parentElement.querySelector('.activity-notes').value;
            let weaningWeight = null;
            let weaningDate = null;
            
            if (activityName === 'Weaning') {
                weaningWeight = buttonElement.parentElement.querySelector('.weaning-weight').value;
                weaningDate = buttonElement.parentElement.querySelector('.weaning-date').value;
                
                if (!weaningWeight || !weaningDate) {
                    alert('Please provide both weaning weight and date for the weaning activity.');
                    return;
                }
            }
            
            try {
                const response = await fetch(`/api/farrowing/complete-activity/${activityId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        notes: notes,
                        weaning_weight: weaningWeight,
                        weaning_date: weaningDate
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Activity completed successfully!');
                    closeUpcomingActivitiesModal();
                    // Refresh the lists to show updated status
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error completing activity:', error);
                alert('Error completing activity. Please try again.');
            }
        }

    </script>
</body>
</html> 